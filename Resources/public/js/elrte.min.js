function eli18n(e){this.textdomain=function(e){return this.messages[e]?this._domain=e:this._domain};e&&e.messages&&this.load(e.messages);e&&e.textdomain&&this.textdomain(e.textdomain)}function elDialogForm(e){var t=this;var n={"class":"el-dialogform",submit:function(e,t){t.close()},form:{action:window.location.href,method:"post"},ajaxForm:null,validate:null,spinner:"Loading",tabs:{active:0,selected:0},tabPrefix:"el-df-tab-",dialog:{title:"dialog",autoOpen:false,modal:true,resizable:false,closeOnEscape:true,buttons:{Cancel:function(){t.close()},Ok:function(){t.form.trigger("submit")}}}};this.opts=jQuery.extend(true,{},n,e);this.opts.dialog.close=function(){t.close()};if(this.opts.rtl){this.opts["class"]+=" el-dialogform-rtl"}if(e&&e.dialog&&e.dialog.buttons&&typeof e.dialog.buttons=="object"){this.opts.dialog.buttons=e.dialog.buttons}this.ul=null;this.tabs={};this._table=null;this.dialog=jQuery("<div />").addClass(this.opts["class"]).dialog(this.opts.dialog);this.message=jQuery('<div class="el-dialogform-message rounded-5" />').hide().appendTo(this.dialog);this.error=jQuery('<div class="el-dialogform-error rounded-5" />').hide().appendTo(this.dialog);this.spinner=jQuery('<div class="spinner" />').hide().appendTo(this.dialog);this.content=jQuery('<div class="el-dialogform-content" />').appendTo(this.dialog);this.form=jQuery("<form />").attr(this.opts.form).appendTo(this.content);if(this.opts.submit){this.form.bind("submit",function(e){t.opts.submit(e,t)})}if(this.opts.ajaxForm&&jQuery.fn.ajaxForm){this.form.ajaxForm(this.opts.ajaxForm)}if(this.opts.validate){this.form.validate(this.opts.validate)}this.option=function(e,t){return this.dialog.dialog("option",e,t)};this.showError=function(e,t){this.hideMessage();this.hideSpinner();this.error.html(e).show();t&&this.content.hide();return this};this.hideError=function(){this.error.text("").hide();this.content.show();return this};this.showSpinner=function(e){this.error.hide();this.message.hide();this.content.hide();this.spinner.text(e||this.opts.spinner).show();this.option("buttons",{});return this};this.hideSpinner=function(){this.content.show();this.spinner.hide();return this};this.showMessage=function(e,t){this.hideError();this.hideSpinner();this.message.html(e||"").show();t&&this.content.hide();return this};this.hideMessage=function(){this.message.hide();this.content.show();return this};this.tab=function(e,t){e=this.opts.tabPrefix+e;if(!this.ul){this.ul=jQuery("<ul />").prependTo(this.form)}jQuery("<li />").append(jQuery("<a />").attr("href","#"+e).html(t)).appendTo(this.ul);this.tabs[e]={tab:jQuery("<div />").attr("id",e).addClass("tab").appendTo(this.form),table:null};return this};this.table=function(e){e=e&&e.indexOf(this.opts.tabPrefix)==-1?this.opts.tabPrefix+e:e;if(e&&this.tabs&&this.tabs[e]){this.tabs[e].table=jQuery("<table />").appendTo(this.tabs[e].tab)}else{this._table=jQuery("<table />").appendTo(this.form)}return this};this.append=function(e,t,n){t=t?"el-df-tab-"+t:"";if(!e){return this}if(t&&this.tabs[t]){if(n){!this.tabs[t].table&&this.table(t);var r=jQuery("<tr />").appendTo(this.tabs[t].table);if(!jQuery.isArray(e)){r.append(jQuery("<td />").append(e))}else{for(var i=0;i<e.length;i++){r.append(jQuery("<td />").append(e[i]))}}}else{if(!jQuery.isArray(e)){this.tabs[t].tab.append(e)}else{for(var i=0;i<e.length;i++){this.tabs[t].tab.append(e[i])}}}}else{if(!n){if(!jQuery.isArray(e)){this.form.append(e)}else{for(var i=0;i<e.length;i++){this.form.append(e[i])}}}else{if(!this._table){this.table()}var r=jQuery("<tr />").appendTo(this._table);if(!jQuery.isArray(e)){r.append(jQuery("<td />").append(e))}else{for(var i=0;i<e.length;i++){r.append(jQuery("<td />").append(e[i]))}}}}return this};this.separator=function(e){e="el-df-tab-"+e;if(this.tabs&&this.tabs[e]){this.tabs[e].tab.append(jQuery("<div />").addClass("separator"));this.tabs[e].table&&this.table(e)}else{this.form.append(jQuery("<div />").addClass("separator"))}return this};this.open=function(){var e=this;this.ul&&this.form.tabs(this.opts.tabs);setTimeout(function(){e.dialog.find(":text").keydown(function(t){if(t.keyCode==13){t.preventDefault();e.form.submit()}}).filter(":first")[0].focus()},200);this.dialog.dialog("open");return this};this.close=function(){if(typeof this.opts.close=="function"){this.opts.close()}this.dialog.dialog("destroy")}}eli18n.prototype=new function(){this.messages={};this._domain="";this.load=function(e){if(typeof e=="object"){for(var t in e){var n=e[t];if(typeof n=="object"){if(!this.messages[t]){this.messages[t]={}}for(var r in n){if(typeof n[r]=="string"){this.messages[t][r]=n[r]}}}}}return this};this.translate=function(e,t){var t=t&&this.messages[t]?t:this._domain;return this.messages[t]&&this.messages[t][e]?this.messages[t][e]:e};this.format=function(e,t,n){e=this.translate(e,n);if(typeof t=="object"){for(var r in t){e=e.replace("%"+r,this.translate(t[r],n))}}return e}};(function(e){e.fn.elColorPicker=function(t){function i(e){n.val(e);r.change&&r.change(n.val());n.palette.slideUp()}function s(){n.palette=e("<div />").addClass(r.paletteClass+" rounded-3");for(var t=0;t<r.colors.length;t++){e("<div />").addClass("color").css("background-color",r.colors[t]).attr({title:r.colors[t],unselectable:"on"}).appendTo(n.palette).mouseenter(function(){var t=e(this).attr("title");n.input.val(t);n.preview.css("background-color",t)}).click(function(t){t.stopPropagation();i(e(this).attr("title"))})}n.input=e('<input type="text" />').addClass("rounded-3").attr("size",8).click(function(t){t.stopPropagation();e(this).focus()}).keydown(function(t){if(t.ctrlKey||t.metaKey){return true}var r=t.keyCode;if(r==27){return n.mouseleave()}if(r!=8&&r!=13&&r!=46&&r!=37&&r!=39&&(r<48||r>57)&&(r<65||r>70)){return false}var s=e(this).val();if(s.length==7||s.length==0){if(r==13){t.stopPropagation();t.preventDefault();i(s);n.palette.slideUp()}if(t.keyCode!=8&&t.keyCode!=46&&r!=37&&r!=39){return false}}}).keyup(function(t){var r=e(this).val();r.length==7&&/^#[0-9abcdef]{6}$/i.test(r)&&n.val(r)});n.preview=e("<div />").addClass("preview rounded-3").click(function(e){e.stopPropagation();i(n.input.val())});n.palette.append(e("<div />").addClass("clearfix")).append(e("<div />").addClass("panel").append(n.input).append(n.preview));if(r.palettePosition=="outer"){n.palette.hide().appendTo(n.parents("body").eq(0)).mouseleave(function(){if(!n.palette.is(":animated")){e(this).slideUp();n.val(n.val())}});n.mouseleave(function(e){if(e.relatedTarget!=n.palette.get(0)){if(!n.palette.is(":animated")){n.palette.slideUp();n.val(n.val())}}})}else{n.append(n.palette.hide()).mouseleave(function(e){n.palette.slideUp();n.val(n.val())})}n.val(n.val())}var n=this;var r=e.extend({},e.fn.elColorPicker.defaults,t);this.hidden=e('<input type="hidden" />').attr("name",r.name).val(r.color||"").appendTo(this);this.palette=null;this.preview=null;this.input=null;this.empty().addClass(r["class"]+" rounded-3").css({position:"relative","background-color":r.color||""}).click(function(t){if(!n.hasClass("disabled")){!n.palette&&s();if(r.palettePosition=="outer"&&n.palette.css("display")=="none"){var i=e(this).offset();var o=n.palette.width();var u=n.parents("body").width()-i.left>=o?i.left:i.left+e(this).outerWidth()-o;n.palette.css({left:u+"px",top:i.top+e(this).height()+1+"px"})}n.palette.slideToggle()}});this.val=function(e){if(!e&&e!==""){return this.hidden.val()}else{this.hidden.val(e);if(r.update){r.update(this.hidden.val())}else{this.css("background-color",e)}if(n.palette){n.preview.css("background-color",e);n.input.val(e)}}return this};return this};e.fn.elColorPicker.defaults={"class":"el-colorpicker",paletteClass:"el-palette",palettePosition:"inner",name:"color",color:"",update:null,change:function(e){},colors:["#ffffff","#cccccc","#999999","#666666","#333333","#000000","#ffcccc","#cc9999","#996666","#663333","#330000","#ff9999","#cc6666","#cc3333","#993333","#660000","#ff6666","#ff3333","#ff0000","#cc0000","#990000","#ff9966","#ff6633","#ff3300","#cc3300","#993300","#ffcc99","#cc9966","#cc6633","#996633","#663300","#ff9933","#ff6600","#ff9900","#cc6600","#cc9933","#ffcc66","#ffcc33","#ffcc00","#cc9900","#996600","#ffffcc","#cccc99","#999966","#666633","#333300","#ffff99","#cccc66","#cccc33","#999933","#666600","#ffff66","#ffff33","#ffff00","#cccc00","#999900","#ccff66","#ccff33","#ccff00","#99cc00","#669900","#ccff99","#99cc66","#99cc33","#669933","#336600","#99ff33","#99ff00","#66ff00","#66cc00","#66cc33","#99ff66","#66ff33","#33ff00","#33cc00","#339900","#ccffcc","#99cc99","#669966","#336633","#003300","#99ff99","#66cc66","#33cc33","#339933","#006600","#66ff66","#33ff33","#00ff00","#00cc00","#009900","#66ff99","#33ff66","#00ff33","#00cc33","#009933","#99ffcc","#66cc99","#33cc66","#339966","#006633","#33ff99","#00ff66","#00ff99","#00cc66","#33cc99","#66ffcc","#33ffcc","#00ffcc","#00cc99","#009966","#ccffff","#99cccc","#669999","#336666","#003333","#99ffff","#66cccc","#33cccc","#339999","#006666","#66cccc","#33ffff","#00ffff","#00cccc","#009999","#66ccff","#33ccff","#00ccff","#0099cc","#006699","#99ccff","#6699cc","#3399cc","#336699","#003366","#3399ff","#0099ff","#0066ff","#066ccc","#3366cc","#6699ff","#3366ff","#0033ff","#0033cc","#003399","#ccccff","#9999cc","#666699","#333366","#000033","#9999ff","#6666cc","#3333cc","#333399","#000066","#6666ff","#3333ff","#0000ff","#0000cc","#009999","#9966ff","#6633ff","#3300ff","#3300cc","#330099","#cc99ff","#9966cc","#6633cc","#663399","#330066","#9933ff","#6600ff","#9900ff","#6600cc","#9933cc","#cc66ff","#cc33ff","#cc00ff","#9900cc","#660099","#ffccff","#cc99cc","#996699","#663366","#330033","#ff99ff","#cc66cc","#cc33cc","#993399","#660066","#ff66ff","#ff33ff","#ff00ff","#cc00cc","#990099","#ff66cc","#ff33cc","#ff00cc","#cc0099","#990066","#ff99cc","#cc6699","#cc3399","#993366","#660033","#ff3399","#ff0099","#ff0066","#cc0066","#cc3366","#ff6699","#ff3366","#ff0033","#cc0033","#990033"]}})(jQuery);(function(e){e.fn.elBorderSelect=function(t){function a(e){function t(e){hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return!e?"00":hexDigits[(e-e%16)/16]+hexDigits[e%16]}var n=(e||"").match(/\(([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3})\)/);return n?"#"+t(n[1])+t(n[2])+t(n[3]):""}function f(t){if(!t){return t}var n=t.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);if(n){t=n[1];unit=n[2]}if(t[0]=="."){t="0"+t}t=parseFloat(t);if(isNaN(t)){return""}var r=parseInt(e(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(t*r);case"pt":return parseInt(t*r/12);case"%":return parseInt(t*r/100)}return t}var n=this;var r=this.eq(0);var i=e.extend({},e.fn.elBorderSelect.defaults,t);var s=e('<input type="text" />').attr({name:i.name+"[width]",size:3}).css("text-align","right").change(function(){n.change()});var o=e("<div />").css("position","relative").elColorPicker({"class":"el-colorpicker ui-icon ui-icon-pencil",name:i.name+"[color]",palettePosition:"outer",change:function(){n.change()}});var u=e("<div />").elSelect({tpl:'<div style="border-bottom:4px %val #000;width:100%;margin:7px 0"> </div>',tpls:{"":"%label"},maxHeight:i.styleHeight||null,select:function(){n.change()},src:{"":"none",solid:"solid",dashed:"dashed",dotted:"dotted","double":"double",groove:"groove",ridge:"ridge",inset:"inset",outset:"outset"}});r.empty().addClass(i["class"]).attr("name",i.name||"").append(e("<table />").attr("cellspacing",0).append(e("<tr />").append(e("<td />").append(s).append(" px")).append(e("<td />").append(u)).append(e("<td />").append(o))));this.change=function(){i.change&&i.change(this.val())};this.val=function(t){var n,r,i,l,c;if(!t&&t!==""){n=parseInt(s.val());n=!isNaN(n)?n+"px":"";r=u.val();i=o.val();return{width:n,style:r,color:i,css:e.trim(n+" "+r+" "+i)}}else{l="";if(t.nodeName||t.css){if(!t.css){t=e(t)}l=t.css("border");if(l=t.css("border")){n=r=i=l}else{n=t.css("border-width");r=t.css("border-style");i=t.css("border-color")}}else{n=t.width||"";r=t.style||"";i=t.color||""}s.val(f(n));c=r?r.match(/(solid|dashed|dotted|double|groove|ridge|inset|outset)/i):"";u.val(c?c[1]:"");o.val(i.indexOf("#")===0?i:a(i));return this}};this.val(i.value);return this};e.fn.elBorderSelect.defaults={name:"el-borderselect","class":"el-borderselect",value:{},change:null}})(jQuery);(function(e){e.fn.elPaddingInput=function(t){function s(t){t=e.trim(t.toString());if(t[0]=="."){t="0"+t}n=parseFloat(t);return!isNaN(n)?n:t=="auto"?t:""}function o(){i.change&&i.change(r)}var r=this;var i=e.extend({},e.fn.elPaddingInput.defaults,{name:this.attr("name")},t);this.regexps={main:new RegExp(i.type=="padding"?'paddings*:s*([^;"]+)':'margins*:s*([^;"]+)',"im"),left:new RegExp(i.type=="padding"?'padding-lefts*:s*([^;"]+)':'margin-lefts*:s*([^;"]+)',"im"),top:new RegExp(i.type=="padding"?'padding-tops*:s*([^;"]+)':'margin-tops*:s*([^;"]+)',"im"),right:new RegExp(i.type=="padding"?'padding-rights*:s*([^;"]+)':'margin-rights*:s*([^;"]+)',"im"),bottom:new RegExp(i.type=="padding"?'padding-bottoms*:s*([^;"]+)':'margin-bottoms*:s*([^;"]+)',"im")};e.each(["left","top","right","bottom"],function(){r[this]=e('<input type="text" />').attr("size",3).css("text-align","right").css("border-"+this,"2px solid red").bind("change",function(){e(this).val(s(e(this).val()));o()}).attr("name",i.name+"["+this+"]")});e.each(["uleft","utop","uright","ubottom"],function(){r[this]=e("<select />").append('<option value="px">px</option>').append('<option value="em">em</option>').append('<option value="pt">pt</option>').bind("change",function(){o()}).attr("name",i.name+"["+this+"]");if(i.percents){r[this].append('<option value="%">%</option>')}});this.empty().addClass(i["class"]).append(this.left).append(this.uleft).append(" x ").append(this.top).append(this.utop).append(" x ").append(this.right).append(this.uright).append(" x ").append(this.bottom).append(this.ubottom);this.val=function(t){if(!t&&t!==""){var n=s(this.left.val());var i=s(this.top.val());var o=s(this.right.val());var u=s(this.bottom.val());var a={left:n=="auto"||n==0?n:n!==""?n+this.uleft.val():"",top:i=="auto"||i==0?i:i!==""?i+this.utop.val():"",right:o=="auto"||o==0?o:o!==""?o+this.uright.val():"",bottom:u=="auto"||u==0?u:u!==""?u+this.ubottom.val():"",css:""};if(a.left!==""&&a.right!==""&&a.top!==""&&a.bottom!==""){if(a.left==a.right&&a.top==a.bottom){a.css=a.top+" "+a.left}else{a.css=a.top+" "+a.right+" "+a.bottom+" "+a.left}}return a}else{if(t.nodeName||t.css){if(!t.css){t=e(t)}var f={left:"",top:"",right:"",bottom:""};var l=(t.attr("style")||"").toLowerCase();if(l){l=e.trim(l);var c=l.match(this.regexps.main);if(c){var h=e.trim(c[1]).replace(/\s+/g," ").split(" ",4);f.top=h[0];f.right=h[1]&&h[1]!==""?h[1]:f.top;f.bottom=h[2]&&h[2]!==""?h[2]:f.top;f.left=h[3]&&h[3]!==""?h[3]:f.right}else{e.each(["left","top","right","bottom"],function(){var e=this.toString();c=l.match(r.regexps[e]);if(c){f[e]=c[1]}})}}var t=f}e.each(["left","top","right","bottom"],function(){var e=this.toString();r[e].val("");r["u"+e].val();if(typeof t[e]!="undefined"&&t[e]!==null){t[e]=t[e].toString();var n=s(t[e]);r[e].val(n);var i=t[e].match(/(px|em|pt|%)/i);r["u"+e].val(i?i[1]:"px")}});return this}};this.val(i.value);return this};e.fn.elPaddingInput.defaults={name:"el-paddinginput","class":"el-paddinginput",type:"padding",value:{},percents:true,change:null}})(jQuery);(function(e){e.fn.elSelect=function(t){function c(e){var t=i.labelTpl||i.tpls[e]||i.tpl;o.html(t.replace(/%val/g,e).replace(/%label/,i.src[e])).children().attr({unselectable:"on"})}function h(){u=e("<div />").addClass(i.listClass+" rounded-3").hide().appendTo(r.mouseleave(function(e){u.slideUp()}));for(var t in i.src){var o=i.tpls[t]||i.tpl;e("<div />").attr("name",t).append(e(o.replace(/%val/g,t).replace(/%label/g,i.src[t])).attr({unselectable:"on"})).appendTo(u).hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")}).click(function(t){t.stopPropagation();t.preventDefault();var r=e(this).attr("name");n.val(r);i.select(r);u.slideUp()})}var a=r.outerWidth();if(u.width()<a){u.width(a)}var f=u.height();if(i.maxHeight>0&&f>i.maxHeight){u.height(i.maxHeight)}n.val(s.val())}var n=this;var r=this.eq(0);var i=e.extend({},e.fn.elSelect.defaults,t);var s=e('<input type="hidden" />').attr("name",i.name);var o=e("<label />").attr({unselectable:"on"}).addClass("rounded-left-3");var u=null;var a=null;if(r.get(0).nodeName=="SELECT"){i.src={};r.children("option").each(function(){i.src[e(this).val()]=e(this).text()});i.value=r.val();i.name=r.attr("name");r.replaceWith(r=e("<div />"))}if(!i.value||!i.src[i.val]){i.value=null;var f=0;for(var l in i.src){if(f++==0){i.value=l}}}this.val=function(t){if(!t&&t!==""){return s.val()}else{if(i.src[t]){s.val(t);c(t);if(u){u.children().each(function(){if(e(this).attr("name")==t){e(this).addClass("active")}else{e(this).removeClass("active")}})}}return this}};r.empty().addClass(i["class"]+" rounded-3").attr({unselectable:"on"}).append(s).append(o).hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")}).click(function(t){!u&&h();u.slideToggle();if(e.browser.msie&&!a){u.children().each(function(){a=Math.max(a,e(this).width())});if(a>u.width()){u.width(a+40)}}});this.val(i.value);return this};e.fn.elSelect.defaults={name:"el-select","class":"el-select",listClass:"list",labelTpl:null,tpl:"<%val>%label</%val>",tpls:{},value:null,src:{},select:function(e){window.console&&window.console.log&&window.console.log("selected: "+e)},maxHeight:410}})(jQuery);(function(e){elRTE=function(t,n){if(!t||!t.nodeName){return alert('elRTE: argument "target" is not DOM Element')}var r=this,i;this.version="1.3";this.build="2011-06-23";this.options=e.extend(true,{},this.options,n);this.browser=e.browser;this.target=e(t);this.lang=""+this.options.lang;this._i18n=new eli18n({textdomain:"rte",messages:{rte:this.i18Messages[this.lang]||{}}});this.rtl=!!(/^(ar|fa|he)$/.test(this.lang)&&this.i18Messages[this.lang]);if(this.rtl){this.options.cssClass+=" el-rte-rtl"}this.toolbar=e('<div class="toolbar"/>');this.iframe=document.createElement("iframe");this.iframe.setAttribute("style","z-index: 1050; -webkit-overflow-scrolling: touch;");this.iframe.setAttribute("frameborder",0);this.workzone=e('<div class="workzone"/>').append(this.iframe).append(this.source);this.statusbar=e('<div class="statusbar"/>');this.tabsbar=e('<div class="tabsbar"/>');this.editor=e('<div class="'+this.options.cssClass+'" />').append(this.toolbar).append(this.workzone).append(this.statusbar).append(this.tabsbar);this.doc=null;this.$doc=null;this.window=null;this.utils=new this.utils(this);this.dom=new this.dom(this);this.filter=new this.filter(this);this.updateHeight=function(){r.workzone.add(r.iframe).add(r.source).height(r.workzone.height())};this.resizable=function(t){var n=this;if(this.options.resizable&&e.fn.resizable){if(t){this.editor.resizable({handles:"se",alsoResize:this.workzone,minWidth:300,minHeight:200}).bind("resize",n.updateHeight)}else{this.editor.resizable("destroy").unbind("resize",n.updateHeight)}}};this.editor.insertAfter(t);var s="";if(t.nodeName=="TEXTAREA"){this.source=this.target;this.source.insertAfter(this.iframe).hide();s=this.target.val()}else{this.source=e("<textarea />").insertAfter(this.iframe).hide();s=this.target.hide().html()}this.source.attr("name",this.target.attr("name")||this.target.attr("id"));s=e.trim(s);if(!s){s=" "}if(this.options.allowSource){this.tabsbar.append('<div class="tab editor rounded-bottom-7 active">'+r.i18n("Editor")+'</div><div class="tab source rounded-bottom-7">'+r.i18n("Source")+'</div><div class="clearfix" style="clear:both"/>').children(".tab").click(function(t){if(!e(this).hasClass("active")){r.tabsbar.children(".tab").toggleClass("active");r.workzone.children().toggle();if(e(this).hasClass("editor")){r.updateEditor();r.window.focus();r.ui.update(true)}else{r.updateSource();r.source.focus();if(e.browser.msie){}else{r.source[0].setSelectionRange(0,0)}r.ui.disable();r.statusbar.empty()}}})}this.window=this.iframe.contentWindow;this.doc=this.iframe.contentWindow.document;this.$doc=e(this.doc);i='<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';e.each(r.options.cssfiles,function(){i+='<link rel="stylesheet" type="text/css" href="'+this+'" />'});this.doc.open();var o=this.filter.wysiwyg(s),u=this.rtl?' class="el-rte-rtl"':"";this.doc.write(r.options.doctype+i+"</head><body"+u+">"+o+"</body></html>");this.doc.close();if(e.browser.msie){this.doc.body.contentEditable=true}else{try{this.doc.designMode="on"}catch(a){}this.doc.execCommand("styleWithCSS",false,this.options.styleWithCSS)}if(this.options.height>0){this.workzone.height(this.options.height)}if(this.options.width>0){this.editor.width(this.options.width)}this.updateHeight();this.resizable(true);this.window.focus();this.history=new this.history(this);this.selection=new this.selection(this);this.ui=new this.ui(this);this.target.parents("form").bind("submit.elfinder",function(e){r.source.parents("form").find('[name="el-select"]').remove();r.beforeSave()});this.source.bind("keydown",function(t){if(t.keyCode==9){t.preventDefault();if(e.browser.msie){var n=document.selection.createRange();n.text="	"+n.text;this.focus()}else{var r=this.value.substr(0,this.selectionStart),i=this.value.substr(this.selectionEnd);this.value=r+"	"+i;this.setSelectionRange(r.length+1,r.length+1)}}});e(this.doc.body).bind("dragend",function(e){setTimeout(function(){try{r.window.focus();var e=r.selection.getBookmark();r.selection.moveToBookmark(e);r.ui.update()}catch(t){}},200)});this.typing=false;this.lastKey=null;this.$doc.bind("mouseup",function(){r.typing=false;r.lastKey=null;r.ui.update()}).bind("keyup",function(e){if(e.keyCode>=8&&e.keyCode<=13||e.keyCode>=32&&e.keyCode<=40||e.keyCode==46||e.keyCode>=96&&e.keyCode<=111){r.ui.update()}}).bind("keydown",function(t){if((t.metaKey||t.ctrlKey)&&t.keyCode==65){r.ui.update()}else if(t.keyCode==13){var n=r.selection.getNode();if(r.dom.selfOrParent(n,/^PRE$/)){r.selection.insertNode(r.doc.createTextNode("\r\n"));return false}else if(e.browser.safari&&t.shiftKey){r.selection.insertNode(r.doc.createElement("br"));return false}}if(t.keyCode>=48&&t.keyCode<=57||t.keyCode==61||t.keyCode==109||t.keyCode>=65&&t.keyCode<=90||t.keyCode==188||t.keyCode==190||t.keyCode==191||t.keyCode>=219&&t.keyCode<=222){if(!r.typing){r.history.add(true)}r.typing=true;r.lastKey=null}else if(t.keyCode==8||t.keyCode==46||t.keyCode==32||t.keyCode==13){if(t.keyCode!=r.lastKey){r.history.add(true)}r.lastKey=t.keyCode;r.typing=false}if(t.keyCode==32&&e.browser.opera){r.selection.insertNode(r.doc.createTextNode(" "));return false}}).bind("paste",function(t){if(!r.options.allowPaste){t.stopPropagation();t.preventDefault()}else{var n=e(r.dom.create("div"))[0],i=r.doc.createTextNode("_");r.history.add(true);r.typing=true;r.lastKey=null;n.appendChild(i);r.selection.deleteContents().insertNode(n);r.selection.select(i);setTimeout(function(){if(n.parentNode){e(n).html(r.filter.proccess("paste",e(n).html()));i=n.lastChild;r.dom.unwrap(n);if(i){r.selection.select(i);r.selection.collapse(false)}}else{n.parentNode&&n.parentNode.removeChild(n);r.val(r.filter.proccess("paste",r.filter.wysiwyg2wysiwyg(e(r.doc.body).html())));r.selection.select(r.doc.body.firstChild);r.selection.collapse(true)}e(r.doc.body).mouseup()},15)}});if(e.browser.msie){this.$doc.bind("keyup",function(t){if(t.keyCode==86&&(t.metaKey||t.ctrlKey)){r.history.add(true);r.typing=true;r.lastKey=null;r.selection.saveIERange();r.val(r.filter.proccess("paste",r.filter.wysiwyg2wysiwyg(e(r.doc.body).html())));r.selection.restoreIERange();e(r.doc.body).mouseup();this.ui.update()}})}if(e.browser.safari){this.$doc.bind("click",function(t){e(r.doc.body).find(".elrte-webkit-hl").removeClass("elrte-webkit-hl");if(t.target.nodeName=="IMG"){e(t.target).addClass("elrte-webkit-hl")}}).bind("keyup",function(t){e(r.doc.body).find(".elrte-webkit-hl").removeClass("elrte-webkit-hl")})}this.window.focus();this.destroy=function(){this.updateSource();this.target.is("textarea")?this.target.val(e.trim(this.source.val())):this.target.html(e.trim(this.source.val()));this.editor.remove();this.target.show().parents("form").unbind("submit.elfinder")}};elRTE.prototype.i18n=function(e){return this._i18n.translate(e)};elRTE.prototype.open=function(){this.editor.show()};elRTE.prototype.close=function(){this.editor.hide()};elRTE.prototype.updateEditor=function(){this.val(this.source.val())};elRTE.prototype.updateSource=function(){this.source.val(this.filter.source(e(this.doc.body).html()))};elRTE.prototype.val=function(t){if(typeof t=="string"){t=""+t;if(this.source.is(":visible")){this.source.val(this.filter.source2source(t))}else{if(e.browser.msie){this.doc.body.innerHTML="<br />"+this.filter.wysiwyg(t);this.doc.body.removeChild(this.doc.body.firstChild)}else{this.doc.body.innerHTML=this.filter.wysiwyg(t)}}}else{if(this.source.is(":visible")){return this.filter.source2source(this.source.val()).trim()}else{return this.filter.source(e(this.doc.body).html()).trim()}}};elRTE.prototype.beforeSave=function(){this.source.val(e.trim(this.val())||"")};elRTE.prototype.save=function(){this.beforeSave();this.editor.parents("form").submit()};elRTE.prototype.log=function(e){if(window.console&&window.console.log){window.console.log(e)}};elRTE.prototype.i18Messages={};e.fn.elrte=function(e,t){var n=typeof e=="string"?e:"",r;this.each(function(){if(!this.elrte){this.elrte=new elRTE(this,typeof e=="object"?e:{})}switch(n){case"open":case"show":this.elrte.open();break;case"close":case"hide":this.elrte.close();break;case"updateSource":this.elrte.updateSource();break;case"destroy":this.elrte.destroy()}});if(n=="val"){if(!this.length){return""}else if(this.length==1){return t?this[0].elrte.val(t):this[0].elrte.val()}else{r={};this.each(function(){r[this.elrte.source.attr("name")]=this.elrte.val()});return r}}return this}})(jQuery);(function(e){elRTE.prototype.dom=function(t){this.rte=t;var n=this;this.regExp={textNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TD|TH|TT|VAR)$/,textContainsNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DL|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|OL|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|TT|UL|VAR)$/,block:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|UL)$/,selectionBlock:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TD|TH|TR|UL)$/,header:/^H[1-6]$/,formElement:/^(FORM|INPUT|HIDDEN|TEXTAREA|SELECT|BUTTON)$/};this.root=function(){return this.rte.body};this.create=function(e){return this.rte.doc.createElement(e)};this.createBookmark=function(){var t=this.rte.doc.createElement("span");t.id="elrte-bm-"+Math.random().toString().substr(2);e(t).addClass("elrtebm elrte-protected");return t};this.indexOf=function(t){var n=0;t=e(t);while((t=t.prev())&&t.length){n++}return n};this.attr=function(t,n){var r="";if(t.nodeType==1){r=e(t).attr(n);if(r&&n!="src"&&n!="href"&&n!="title"&&n!="alt"){r=r.toString().toLowerCase()}}return r||""};this.findCommonAncestor=function(t,n){if(!t||!n){return this.rte.log("dom.findCommonAncestor invalid arguments")}if(t==n){return t}else if(t.nodeName=="BODY"||n.nodeName=="BODY"){return this.rte.doc.body}var r=e(t).parents(),i=e(n).parents(),s=i.length-1,o=i[s];for(var u=r.length-1;u>=0;u--,s--){if(r[u]==i[s]){o=r[u]}else{break}}return o};this.isEmpty=function(t){if(t.nodeType==1){return this.regExp.textNodes.test(t.nodeName)?e.trim(e(t).text()).length==0:false}else if(t.nodeType==3){return/^(TABLE|THEAD|TFOOT|TBODY|TR|UL|OL|DL)$/.test(t.parentNode.nodeName)||t.nodeValue==""||e.trim(t.nodeValue).length==0&&!(t.nextSibling&&t.previousSibling&&t.nextSibling.nodeType==1&&t.previousSibling.nodeType==1&&!this.regExp.block.test(t.nextSibling.nodeName)&&!this.regExp.block.test(t.previousSibling.nodeName))}return true};this.next=function(e){while(e.nextSibling&&(e=e.nextSibling)){if(e.nodeType==1||e.nodeType==3&&!this.isEmpty(e)){return e}}return null};this.prev=function(e){while(e.previousSibling&&(e=e.previousSibling)){if(e.nodeType==1||e.nodeType==3&&!this.isEmpty(e)){return e}}return null};this.isPrev=function(e,t){while(e=this.prev(e)){if(e==t){return true}}return false};this.nextAll=function(e){var t=[];while(e=this.next(e)){t.push(e)}return t};this.prevAll=function(e){var t=[];while(e=this.prev(e)){t.push(e)}return t};this.toLineEnd=function(e){var t=[];while((e=this.next(e))&&e.nodeName!="BR"&&e.nodeName!="HR"&&this.isInline(e)){t.push(e)}return t};this.toLineStart=function(e){var t=[];while((e=this.prev(e))&&e.nodeName!="BR"&&e.nodeName!="HR"&&this.isInline(e)){t.unshift(e)}return t};this.isFirstNotEmpty=function(t){while(t=this.prev(t)){if(t.nodeType==1||t.nodeType==3&&e.trim(t.nodeValue)!=""){return false}}return true};this.isLastNotEmpty=function(e){while(e=this.next(e)){if(!this.isEmpty(e)){return false}}return true};this.isOnlyNotEmpty=function(e){return this.isFirstNotEmpty(e)&&this.isLastNotEmpty(e)};this.findLastNotEmpty=function(e){this.rte.log("findLastNotEmpty Who is here 0_o");if(e.nodeType==1&&(l=e.lastChild)){if(!this.isEmpty(l)){return l}while(l.previousSibling&&(l=l.previousSibling)){if(!this.isEmpty(l)){return l}}}return false};this.isInline=function(t){if(t.nodeType==3){return true}else if(t.nodeType==1){t=e(t);var n=t.css("display");var r=t.css("float");return n=="inline"||n=="inline-block"||r=="left"||r=="right"}return true};this.is=function(e,t){if(e&&e.nodeName){if(typeof t=="string"){t=this.regExp[t]||/.?/}if(t instanceof RegExp&&e.nodeName){return t.test(e.nodeName)}else if(typeof t=="function"){return t(e)}}return false};this.filter=function(e,t){var n=[],r;if(!e.push){return this.is(e,t)?e:null}for(r=0;r<e.length;r++){if(this.is(e[r],t)){n.push(e[r])}}return n};this.parents=function(e,t){var n=[];while(e&&(e=e.parentNode)&&e.nodeName!="BODY"&&e.nodeName!="HTML"){if(this.is(e,t)){n.push(e)}}return n};this.parent=function(e,t){return this.parents(e,t)[0]||null};this.selfOrParent=function(e,t,n){return this.is(e,t)?e:this.parent(e,n||t)};this.selfOrParentLink=function(e){e=this.selfOrParent(e,/^A$/);return e&&e.href?e:null};this.selfOrParentAnchor=function(e){e=this.selfOrParent(e,/^A$/);return e&&!e.href&&e.name?e:null};this.childLinks=function(t){var n=[];e("a[href]",t).each(function(){n.push(this)});return n};this.selectionHas=function(e){var t=this.rte.selection.cloneContents(),n;if(t&&t.childNodes&&t.childNodes.length){for(n=0;n<t.childNodes.length;n++){if(typeof e=="function"){if(e(t.childNodes[n])){return true}}else if(t instanceof RegExp){if(e.test(t.childNodes[n].nodeName)){return true}}}}return false};this.wrap=function(t,n){t=e.isArray(t)?t:[t];n=n.nodeName?n:this.create(n);if(t[0]&&t[0].nodeType&&t[0].parentNode){n=t[0].parentNode.insertBefore(n,t[0]);e(t).each(function(){if(this!=n){n.appendChild(this)}})}return n};this.unwrap=function(e){if(e&&e.parentNode){while(e.firstChild){e.parentNode.insertBefore(e.firstChild,e)}e.parentNode.removeChild(e)}};this.wrapContents=function(e,t){t=t.nodeName?t:this.create(t);for(var n=0;n<e.childNodes.length;n++){t.appendChild(e.childNodes[n])}e.appendChild(t);return t};this.cleanNode=function(t){if(t.nodeType!=1){return}if(/^(P|LI)$/.test(t.nodeName)&&(l=this.findLastNotEmpty(t))&&l.nodeName=="BR"){e(l).remove()}$n=e(t);$n.children().each(function(){this.cleanNode(this)});if(t.nodeName!="BODY"&&!/^(TABLE|TR|TD)$/.test(t)&&this.isEmpty(t)){return $n.remove()}if($n.attr("style")===""){$n.removeAttr("style")}if(this.rte.browser.safari&&$n.hasClass("Apple-span")){$n.removeClass("Apple-span")}if(t.nodeName=="SPAN"&&!$n.attr("style")&&!$n.attr("class")&&!$n.attr("id")){$n.replaceWith($n.html())}};this.cleanChildNodes=function(t){var n=this.cleanNode;e(t).children().each(function(){n(this)})};this.tableMatrix=function(t){var n=[];if(t&&t.nodeName=="TABLE"){var r=0;function i(e){for(var t=0;t<=r;t++){if(!n[e][t]){return t}}}e(t).find("tr").each(function(t){if(!e.isArray(n[t])){n[t]=[]}e(this).children("td,th").each(function(){var s=parseInt(e(this).attr("colspan")||1);var o=parseInt(e(this).attr("rowspan")||1);var u=i(t);for(var a=0;a<o;a++){for(var f=0;f<s;f++){var l=t+a;if(!e.isArray(n[l])){n[l]=[]}var c=f==0&&a==0?this:a==0?f:"-";n[l][u+f]=c}}r=Math.max(r,n[t].length)})})}return n};this.indexesOfCell=function(e,t){for(var n=0;n<t.length;n++){for(var r=0;r<t[n].length;r++){if(t[n][r]==e){return[n,r]}}}};this.fixTable=function(t){if(t&&t.nodeName=="TABLE"){var n=e(t);var r=this.tableMatrix(t);var s=0;e.each(r,function(){s=Math.max(s,this.length)});if(s==0){return n.remove()}for(var o=0;o<r.length;o++){var u=r[o].length;if(u==0){n.find("tr").eq(o).remove()}else if(u<s){var a=s-u;var f=n.find("tr").eq(o);for(i=0;i<a;i++){f.append("<td>&nbsp;</td>")}}}}};this.tableColumn=function(e,t,n){e=this.selfOrParent(e,/^TD|TH$/);var r=this.selfOrParent(e,/^TABLE$/);ret=[];info={offset:[],delta:[]};if(e&&r){n&&this.fixTable(r);var i=this.tableMatrix(r);var s=false;var o;for(var u=0;u<i.length;u++){for(var a=0;a<i[u].length;a++){if(i[u][a]==e){o=a;s=true;break}}if(s){break}}if(o>=0){for(var u=0;u<i.length;u++){var f=i[u][o]||null;if(f){if(f.nodeName){ret.push(f);if(t){info.delta.push(0);info.offset.push(o)}}else{var l=parseInt(f);if(!isNaN(l)&&i[u][o-l]&&i[u][o-l].nodeName){ret.push(i[u][o-l]);if(t){info.delta.push(l);info.offset.push(o)}}}}}}}return!t?ret:{column:ret,info:info}}}})(jQuery);(function(e){elRTE.prototype.filter=function(t){var n=this,r=e("<span/>").addClass("elrtetesturl").appendTo(document.body)[0];this.url=(typeof r.currentStyle!="undefined"?r.currentStyle["backgroundImage"]:document.defaultView.getComputedStyle(r,null)["backgroundImage"]).replace(/^url\((['"]?)([\s\S]+\/)[\s\S]+\1\)$/i,"$2");e(r).remove();this.rte=t;this.xhtml=/xhtml/i.test(t.options.doctype);this.boolAttrs=t.utils.makeObject("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected".split(","));this.tagRegExp=/<(\/?)([\w:]+)((?:\s+[a-z\-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*\/?>/g;this.openTagRegExp=/<([\w:]+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*\/?>/g;this.attrRegExp=/(\w+)(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^\s]+))?/g;this.scriptRegExp=/<script([^>]*)>([\s\S]*?)<\/script>/gi;this.styleRegExp=/(<style([^>]*)>[\s\S]*?<\/style>)/gi;this.linkRegExp=/(<link([^>]+)>)/gi;this.cdataRegExp=/<!\[CDATA\[([\s\S]+)\]\]>/g;this.objRegExp=/<object([^>]*)>([\s\S]*?)<\/object>/gi;this.embRegExp=/<(embed)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*>/gi;this.paramRegExp=/<(param)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*>/gi;this.iframeRegExp=/<iframe([^>]*)>([\s\S]*?)<\/iframe>/gi;this.yMapsRegExp=/<div\s+([^>]*id\s*=\s*('|")?YMapsID[^>]*)>/gi;this.gMapsRegExp=/<iframe\s+([^>]*src\s*=\s*"http:\/\/maps\.google\.\w+[^>]*)>([\s\S]*?)<\/iframe>/gi;this.videoHostRegExp=/^(http:\/\/[\w\.]*)?(youtube|vimeo|rutube).*/i;this.serviceClassRegExp=/<(\w+)([^>]*class\s*=\s*"[^>]*elrte-[^>]*)>\s*(<\/\1>)?/gi;this.pagebreakRegExp=/<(\w+)([^>]*style\s*=\s*"[^>]*page-break[^>]*)>\s*(<\/\1>)?/gi;this.pbRegExp=new RegExp("<!-- pagebreak -->","gi");this.allowTags=t.options.allowTags.length?t.utils.makeObject(t.options.allowTags):null;this.denyTags=t.options.denyTags.length?t.utils.makeObject(t.options.denyTags):null;this.denyAttr=t.options.denyAttr?t.utils.makeObject(t.options.denyAttr):null;this.pasteDenyAttr=t.options.pasteDenyAttr?t.utils.makeObject(t.options.pasteDenyAttr):null;this.fontSize=["medium","xx-small","small","medium","large","x-large","xx-large"];this.fontFamily={"sans-serif":/^(arial|tahoma|verdana)$/i,serif:/^(times|times new roman)$/i,monospace:/^courier$/i};this.scripts={};this._chains={};e.each(this.chains,function(t){n._chains[t]=[];e.each(this,function(e,r){typeof n.rules[r]=="function"&&n._chains[t].push(n.rules[r])})});this.proccess=function(t,r){r=e.trim(r).replace(/^\s*(&nbsp;)+/gi,"").replace(/(&nbsp;|<br[^>]*>)+\s*$/gi,"");e.each(this._chains[t]||[],function(){r=this.call(n,r)});r=r.replace(/\t/g,"  ").replace(/\r/g,"").replace(/\s*\n\s*\n+/g,"\n")+"  ";return e.trim(r)?r:" "};this.wysiwyg=function(e){return this.proccess("wysiwyg",e)};this.source=function(e){return this.proccess("source",e)};this.source2source=function(e){return this.proccess("source2source",e)};this.wysiwyg2wysiwyg=function(e){return this.proccess("wysiwyg2wysiwyg",e)};this.parseAttrs=function(t){var n={},r=this.boolAttrs,i=t.match(this.attrRegExp),s,o,u;i&&e.each(i,function(t,i){s=i.split("=");o=e.trim(s[0]).toLowerCase();if(s.length>2){s.shift();u=s.join("=")}else{u=r[o]||s[1]||""}n[o]=e.trim(u).replace(/^('|")(.*)(\1)$/,"$2")});n.style=this.rte.utils.parseStyle(n.style);n["class"]=this.rte.utils.parseClass(n["class"]||"");return n};this.serializeAttrs=function(t,n){var r=[],i=this;e.each(t,function(e,t){if(e=="style"){t=i.rte.utils.serializeStyle(t,n)}else if(e=="class"){t=i.rte.utils.serializeClass(t)}t&&r.push(e+'="'+t+'"')});return r.join(" ")};this.cleanAttrs=function(t,n){function s(e){return e+(/\d$/.test(e)?"px":"")}var r=this,i=this.replaceAttrs;e.each(t["class"],function(e){/^(Apple-style-span|mso\w+)$/i.test(e)&&delete t["class"][e]});e.each(t,function(o,u){i[o]&&i[o].call(r,t,n);if(o=="style"){e.each(u,function(e,n){switch(e){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":t.style[e.replace(/^mso-|-alt$/g,"")]=s(n);delete t.style[e];break;case"horiz-align":t.style["text-align"]=n;delete t.style[e];break;case"vert-align":t.style["vertical-align"]=n;delete t.style[e];break;case"font-color":case"mso-foreground":t.style.color=n;delete t.style[e];break;case"mso-background":case"mso-highlight":t.style.background=n;delete t.style[e];break;case"mso-default-height":t.style["min-height"]=s(n);delete t.style[e];break;case"mso-default-width":t.style["min-width"]=s(n);delete t.style[e];break;case"mso-padding-between-alt":t.style["border-collapse"]="separate";t.style["border-spacing"]=s(n);delete t.style[e];break;case"text-line-through":if(n.match(/(single|double)/i)){t.style["text-decoration"]="line-through"}delete t.style[e];break;case"mso-zero-height":if(n=="yes"){t.style.display="none"}delete t.style[e];break;case"font-weight":if(n==700){t.style["font-weight"]="bold"}break;default:if(e.match(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/)){delete t.style[e]}}})}});return t}};elRTE.prototype.filter.prototype.replaceTags={b:{tag:"strong"},big:{tag:"span",style:{"font-size":"large"}},center:{tag:"div",style:{"text-align":"center"}},i:{tag:"em"},font:{tag:"span"},nobr:{tag:"span",style:{"white-space":"nowrap"}},menu:{tag:"ul"},plaintext:{tag:"pre"},s:{tag:"strike"},small:{tag:"span",style:{"font-size":"small"}},u:{tag:"span",style:{"text-decoration":"underline"}},xmp:{tag:"pre"}};elRTE.prototype.filter.prototype.replaceAttrs={align:function(e,t){switch(t){case"img":e.style[e.align.match(/(left|right)/)?"float":"vertical-align"]=e.align;break;case"table":if(e.align=="center"){e.style["margin-left"]=e.style["margin-right"]="auto"}else{e.style["float"]=e.align}break;default:e.style["text-align"]=e.align}delete e.align},border:function(e){!e.style["border-width"]&&(e.style["border-width"]=(parseInt(e.border)||1)+"px");!e.style["border-style"]&&(e.style["border-style"]="solid");delete e.border},bordercolor:function(e){!e.style["border-color"]&&(e.style["border-color"]=e.bordercolor);delete e.bordercolor},background:function(e){!e.style["background-image"]&&(e.style["background-image"]="url("+e.background+")");delete e.background},bgcolor:function(e){!e.style["background-color"]&&(e.style["background-color"]=e.bgcolor);delete e.bgcolor},clear:function(e){e.style.clear=e.clear=="all"?"both":e.clear;delete e.clear},color:function(e){!e.style.color&&(e.style.color=e.color);delete e.color},face:function(t){var n=t.face.toLowerCase();e.each(this.fontFamily,function(e,r){if(n.match(r)){t.style["font-family"]=n+","+e}});delete t.face},hspace:function(e,t){if(t=="img"){var n=parseInt(e.hspace)||0;!e.style["margin-left"]&&(e.style["margin-left"]=n+"px");!e.style["margin-right"]&&(e.style["margin-right"]=n+"px");delete e.hspace}},size:function(e,t){if(t!="input"){e.style["font-size"]=this.fontSize[parseInt(e.size)||0]||"medium";delete e.size}},valign:function(e){if(!e.style["vertical-align"]){e.style["vertical-align"]=e.valign}delete e.valign},vspace:function(e,t){if(t=="img"){var n=parseInt(e.vspace)||0;!e.style["margin-top"]&&(e.style["margin-top"]=n+"px");!e.style["margin-bottom"]&&(e.style["margin-bottom"]=n+"px");delete e.hspace}}};elRTE.prototype.filter.prototype.rules={allowedTags:function(e){var t=this.allowTags;return t?e.replace(this.tagRegExp,function(e,n,r){return t[r.toLowerCase()]?e:""}):e},deniedTags:function(e){var t=this.denyTags;return t?e.replace(this.tagRegExp,function(e,n,r){return t[r.toLowerCase()]?"":e}):e},clean:function(t){var n=this,r=this.replaceTags,i=this.replaceAttrs,s=this.denyAttr,o;t=t.replace(/<!DOCTYPE([\s\S]*)>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s&nbsp;]*)<\/span>/gi,"$1").replace(/(<p[^>]*>\s*<\/p>|<p[^>]*\/>)/gi,"<br>").replace(/(<\/p>)(?:\s*<br\s*\/?>\s*|\s*&nbsp;\s*)+\s*(<p[^>]*>)/gi,function(e,t,n){return t+"\n"+n}).replace(this.tagRegExp,function(t,i,o,u){o=o.toLowerCase();if(i){return"</"+(r[o]?r[o].tag:o)+">"}u=n.cleanAttrs(n.parseAttrs(u||""),o);if(r[o]){r[o].style&&e.extend(u.style,r[o].style);o=r[o].tag}s&&e.each(u,function(e){if(s[e]){delete u[e]}});u=n.serializeAttrs(u);return"<"+o+(u?" ":"")+u+">"});o=e("<div>"+t+"</div>");o.find("span:not([id]):not([class])").each(function(){var t=e(this);if(!t.attr("style")){e.trim(t.html()).length?n.rte.dom.unwrap(this):t.remove()}}).end().find("span span:only-child").each(function(){var t=e(this),r=t.parent().eq(0),i=t.attr("id"),s=r.attr("id"),o,u,a;if(n.rte.dom.isOnlyNotEmpty(this)&&(!i||!s)){a=e.trim(r.attr("class")+" "+t.attr("class"));a&&r.attr("class",a);u=n.rte.utils.serializeStyle(e.extend(n.rte.utils.parseStyle(e(this).attr("style")||""),n.rte.utils.parseStyle(e(r).attr("style")||"")));u&&r.attr("style",u);o=i||s;o&&r.attr("id",o);this.firstChild?e(this.firstChild).unwrap():t.remove()}}).end().find("a[name]").each(function(){e(this).addClass("elrte-protected elrte-anchor")});return o.html()},cleanPaste:function(t){var n=this,r=this.pasteDenyAttr;t=t.replace(this.scriptRegExp,"").replace(this.styleRegExp,"").replace(this.linkRegExp,"").replace(this.cdataRegExp,"").replace(/\<\!--[\s\S]*?--\>/g,"");if(this.rte.options.pasteOnlyText){t=t.replace(this.tagRegExp,function(e,t,n){return/br/i.test(n)||t&&/h[1-6]|p|ol|ul|li|div|blockquote|tr/i?"<br>":""}).replace(/(&nbsp;|<br[^>]*>)+\s*$/gi,"")}else if(r){t=t.replace(this.openTagRegExp,function(t,i,s){s=n.parseAttrs(s);e.each(s,function(e){if(r[e]){delete s[e]}});s=n.serializeAttrs(s,true);return"<"+i+(s?" ":"")+s+">"})}return t},replace:function(t){function s(e,t){function l(){if(e.embed&&e.embed.src){return e.embed.src}if(e.params&&e.params.length){f=e.params.length;while(f--){if(e.params[f].name=="src"||e.params[f].name=="movie"){return e.params[f].value}}}}var r=l(),i=r&&n.videoHostRegExp.test(r)?r.replace(n.videoHostRegExp,"$2"):t.replace(/^\w+\/(.+)/,"$1"),s=parseInt((e.obj?e.obj.width||e.obj.style.width:0)||(e.embed?e.embed.width||e.embed.style.width:0))||150,o=parseInt((e.obj?e.obj.height||e.obj.style.height:0)||(e.embed?e.embed.height||e.embed.style.height:0))||100,u="media"+Math.random().toString().substring(2),a="",f;if(e.obj&&e.obj.style&&e.obj.style["float"]){a=' style="float:'+e.obj.style["float"]+'"'}n.scripts[u]=e;return'<img src="'+n.url+'pixel.gif" class="elrte-media elrte-media-'+i+' elrte-protected" title="'+(r?n.rte.utils.encode(r):"")+'" rel="'+u+'" width="'+s+'" height="'+o+'"'+a+">"}var n=this,r=this.rte.options.replace||[],i;if(r.length){e.each(r,function(e,r){if(typeof r=="function"){t=r.call(n,t)}})}t=t.replace(this.styleRegExp,"<!-- ELRTE_COMMENT$1 -->").replace(this.linkRegExp,"<!-- ELRTE_COMMENT$1-->").replace(this.cdataRegExp,"<!--[CDATA[$1]]-->").replace(this.scriptRegExp,function(e,t,r){var i;if(n.denyTags.script){return""}i="script"+Math.random().toString().substring(2);t=n.parseAttrs(t);!t.type&&(t.type="text/javascript");n.scripts[i]="<script "+n.serializeAttrs(t)+">"+r+"</script>";return"<!-- ELRTE_SCRIPT:"+i+" -->"}).replace(this.yMapsRegExp,function(e,t){t=n.parseAttrs(t);t["class"]["elrte-yandex-maps"]="elrte-yandex-maps";t["class"]["elrte-protected"]="elrte-protected";return"<div "+n.serializeAttrs(t)+">"}).replace(this.gMapsRegExp,function(e,t){var r="gmaps"+Math.random().toString().substring(2),i,s;t=n.parseAttrs(t);i=parseInt(t.width||t.style.width||100);s=parseInt(t.height||t.style.height||100);n.scripts[r]=e;return'<img src="'+n.url+'pixel.gif" class="elrte-google-maps elrte-protected" id="'+r+'" style="width:'+i+"px;height:"+s+'px">'}).replace(this.objRegExp,function(t,r,i){var o=i.match(n.embRegExp),u={obj:n.parseAttrs(r),embed:o&&o.length?n.parseAttrs(o[0].substring(7)):null,params:[]},a=n.rte.utils.mediaInfo(u.embed?u.embed.type||"":"",u.obj.classid||"");if(a){if(o=i.match(n.paramRegExp)){e.each(o,function(e,t){u.params.push(n.parseAttrs(t.substring(6)))})}!u.obj.classid&&(u.obj.classid=a.classid[0]);!u.obj.codebase&&(u.obj.codebase=a.codebase);u.embed&&!u.embed.type&&(u.embed.type=a.type);u.obj.width=="1"&&delete u.obj.width;u.obj.height=="1"&&delete u.obj.height;if(u.embed){u.embed.width=="1"&&delete u.embed.width;u.embed.height=="1"&&delete u.embed.height}return s(u,a.type)}return t}).replace(this.embRegExp,function(e,t,r){var r=n.parseAttrs(r),i=n.rte.utils.mediaInfo(r.type||"");r.width=="1"&&delete r.width;r.height=="1"&&delete r.height;return i?s({embed:r},i.type):e}).replace(this.iframeRegExp,function(e,t){var t=n.parseAttrs(t);var r=t.style.width||(parseInt(t.width)>1?parseInt(t.width)+"px":"100px");var i=t.style.height||(parseInt(t.height)>1?parseInt(t.height)+"px":"100px");var s="iframe"+Math.random().toString().substring(2);n.scripts[s]=e;var o='<img id="'+s+'" src="'+n.url+'pixel.gif" class="elrte-protected elrte-iframe" style="width:'+r+"; height:"+i+'">';return o}).replace(this.vimeoRegExp,function(e,t,r){r=n.parseAttrs(r);delete r.frameborder;r.width=="1"&&delete r.width;r.height=="1"&&delete r.height;r.type="application/x-shockwave-flash";return s({embed:r},"application/x-shockwave-flash")}).replace(/<\/(embed|param)>/gi,"").replace(this.pbRegExp,function(){return'<img src="'+n.url+'pixel.gif" class="elrte-protected elrte-pagebreak">'});i=e("<div>"+t+"</div>");if(!this.rte.options.allowTextNodes){var o=this.rte.dom,u=[],a=[];if(e.browser.msie){for(var f=0;f<i[0].childNodes.length;f++){u.push(i[0].childNodes[f])}}else{u=Array.prototype.slice.call(i[0].childNodes)}function l(){if(a.length&&o.filter(a,"notEmpty").length){o.wrap(a,document.createElement("p"))}a=[]}e.each(u,function(e,t){if(o.is(t,"block")){l()}else{if(a.length&&t.previousSibling!=a[a.length-1]){l()}a.push(t)}});l()}return i.html()},restore:function(t){var n=this,r=this.rte.options.restore||[];if(r.length){e.each(r,function(e,r){if(typeof r=="function"){t=r.call(n,t)}})}t=t.replace(/\<\!--\[CDATA\[([\s\S]*?)\]\]--\>/gi,"<![CDATA[$1]]>").replace(/\<\!--\s*ELRTE_SCRIPT\:\s*(script\d+)\s*--\>/gi,function(e,t){if(n.scripts[t]){e=n.scripts[t];delete n.scripts[t]}return e||""}).replace(/\<\!-- ELRTE_COMMENT([\s\S]*?) --\>/gi,"$1").replace(this.serviceClassRegExp,function(t,r,i,s){var i=n.parseAttrs(i),o,u="";if(i["class"]["elrte-google-maps"]){var t="";if(n.scripts[i.id]){t=n.scripts[i.id];delete n.scripts[i.id]}return t}else if(i["class"]["elrte-iframe"]){return n.scripts[i.id]||""}else if(i["class"]["elrtebm"]){return""}else if(i["class"]["elrte-media"]){o=n.scripts[i.rel]||{};o.params&&e.each(o.params,function(e,t){u+="<param "+n.serializeAttrs(t)+">\n"});o.embed&&(u+="<embed "+n.serializeAttrs(o.embed)+">");o.obj&&(u="<object "+n.serializeAttrs(o.obj)+">\n"+u+"\n</object>\n");return u||t}else if(i["class"]["elrte-pagebreak"]){return"<!-- pagebreak -->"}e.each(i["class"],function(e){if(/^elrte-\w+/i.test(e)){delete i["class"][e]}});return"<"+r+" "+n.serializeAttrs(i)+">"+(s||"")});return t},compactStyles:function(e){var t=this;return e.replace(this.tagRegExp,function(e,n,r,i){i=!n&&i?t.serializeAttrs(t.parseAttrs(i),true):"";return"<"+n+r.toLowerCase()+(i?" ":"")+i+">"})},xhtmlTags:function(e){return this.xhtml?e.replace(/<(img|hr|br|embed|param|link|area)([^>]*\/*)>/gi,"<$1$2 />"):e}};elRTE.prototype.filter.prototype.chains={wysiwyg:["replace","clean","allowedTags","deniedTags","compactStyles"],source:["clean","allowedTags","restore","compactStyles","xhtmlTags"],paste:["clean","allowedTags","cleanPaste","replace","deniedTags","compactStyles"],wysiwyg2wysiwyg:["clean","allowedTags","restore","replace","deniedTags","compactStyles"],source2source:["clean","allowedTags","replace","deniedTags","restore","compactStyles","xhtmlTags"]}})(jQuery);(function(e){elRTE.prototype.history=function(t){this.rte=t;this._prev=[];this._next=[];this.add=function(){if(this.rte.options.historyLength>0&&this._prev.length>=this.rte.options.historyLength){this._prev.slice(this.rte.options.historyLength)}var t=this.rte.selection.getBookmark();this._prev.push([e(this.rte.doc.body).html(),t]);this.rte.selection.moveToBookmark(t);this._next=[]};this.back=function(){if(this._prev.length){var t=this.rte.selection.getBookmark(),n=this._prev.pop();this._next.push([e(this.rte.doc.body).html(),t]);e(this.rte.doc.body).html(n[0]);this.rte.selection.moveToBookmark(n[1])}};this.fwd=function(){if(this._next.length){var t=this.rte.selection.getBookmark(),n=this._next.pop();this._prev.push([e(this.rte.doc.body).html(),t]);e(this.rte.doc.body).html(n[0]);this.rte.selection.moveToBookmark(n[1])}};this.canBack=function(){return this._prev.length};this.canFwd=function(){return this._next.length}}})(jQuery);(function(e){elRTE.prototype.options={doctype:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">',cssClass:"el-rte",cssfiles:[],height:null,resizable:true,lang:"en",toolbar:"normal",absoluteURLs:true,allowSource:true,stripWhiteSpace:true,styleWithCSS:false,fmAllow:true,fmOpen:null,allowTags:[],denyTags:["applet","base","basefont","bgsound","blink","body","col","colgroup","isindex","frameset","html","head","meta","marquee","noframes","noembed","o:p","title","xml"],denyAttr:[],pasteDenyAttr:["id","name","class","style","language","onclick","ondblclick","onhover","onkeup","onkeydown","onkeypress"],allowTextNodes:true,allowBrowsersSpecStyles:false,allowPaste:true,pasteOnlyText:false,replace:[],restore:[],pagebreak:'<div style="page-break-after: always;"></div>',buttons:{save:"Save",copy:"Copy",cut:"Cut",css:"Css style and class",paste:"Paste",pastetext:"Paste only text",pasteformattext:"Paste formatted text",removeformat:"Clean format",undo:"Undo last action",redo:"Redo previous action",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",superscript:"Superscript",subscript:"Subscript",justifyleft:"Align left",justifyright:"Ailgn right",justifycenter:"Align center",justifyfull:"Align full",indent:"Indent",outdent:"Outdent",rtl:"Right to left",ltr:"Left to right",forecolor:"Font color",hilitecolor:"Background color",formatblock:"Format",fontsize:"Font size",fontname:"Font",insertorderedlist:"Ordered list",insertunorderedlist:"Unordered list",horizontalrule:"Horizontal rule",blockquote:"Blockquote",div:"Block element (DIV)",link:"Link",unlink:"Delete link",anchor:"Bookmark",image:"Image",pagebreak:"Page break",smiley:"Smiley",flash:"Flash",table:"Table",tablerm:"Delete table",tableprops:"Table properties",tbcellprops:"Table cell properties",tbrowbefore:"Insert row before",tbrowafter:"Insert row after",tbrowrm:"Delete row",tbcolbefore:"Insert column before",tbcolafter:"Insert column after",tbcolrm:"Delete column",tbcellsmerge:"Merge table cells",tbcellsplit:"Split table cell",docstructure:"Toggle display document structure",elfinder:"Open file manager",fullscreen:"Toggle full screen mode",nbsp:"Non breakable space",stopfloat:"Stop element floating",about:"About this software"},panels:{eol:[],save:["save"],copypaste:["copy","cut","paste","pastetext","pasteformattext","removeformat","docstructure"],undoredo:["undo","redo"],style:["bold","italic","underline","strikethrough","subscript","superscript"],colors:["forecolor","hilitecolor"],alignment:["justifyleft","justifycenter","justifyright","justifyfull"],indent:["outdent","indent"],format:["formatblock","fontsize","fontname"],lists:["insertorderedlist","insertunorderedlist"],elements:["horizontalrule","blockquote","div","stopfloat","css","nbsp","smiley","pagebreak"],direction:["ltr","rtl"],links:["link","unlink","anchor"],images:["image"],media:["image","flash"],tables:["table","tableprops","tablerm","tbrowbefore","tbrowafter","tbrowrm","tbcolbefore","tbcolafter","tbcolrm","tbcellprops","tbcellsmerge","tbcellsplit"],elfinder:["elfinder"],fullscreen:["fullscreen","about"]},toolbars:{tiny:["style"],compact:["save","undoredo","style","alignment","lists","links","fullscreen"],normal:["save","copypaste","undoredo","style","alignment","colors","indent","lists","links","elements","images","fullscreen"],complete:["save","copypaste","undoredo","style","alignment","colors","format","indent","lists","links","elements","media","fullscreen"],maxi:["save","copypaste","undoredo","elfinder","style","alignment","direction","colors","format","indent","lists","links","elements","media","tables","fullscreen"],eldorado:["save","copypaste","elfinder","undoredo","style","alignment","colors","format","indent","lists","links","elements","media","tables","fullscreen"]},panelNames:{save:"Save",copypaste:"Copy/Pase",undoredo:"Undo/Redo",style:"Text styles",colors:"Colors",alignment:"Alignment",indent:"Indent/Outdent",format:"Text format",lists:"Lists",elements:"Misc elements",direction:"Script direction",links:"Links",images:"Images",media:"Media",tables:"Tables",elfinder:"File manager (elFinder)"}}})(jQuery);(function(e){elRTE.prototype.selection=function(t){function u(){return n.rte.window.getSelection?n.rte.window.getSelection():n.rte.window.document.selection}function a(e,t,r){while(e.nodeName!="BODY"&&e.parentNode&&e.parentNode.nodeName!="BODY"&&(t?e!==t&&e.parentNode!=t:1)&&(r=="left"&&n.rte.dom.isFirstNotEmpty(e)||r=="right"&&n.rte.dom.isLastNotEmpty(e)||n.rte.dom.isFirstNotEmpty(e)&&n.rte.dom.isLastNotEmpty(e))){e=e.parentNode}return e}this.rte=t;var n=this;this.w3cRange=null;var r,i,s,o;e(this.rte.doc).keyup(function(e){if(e.ctrlKey||e.metaKey||e.keyCode>=8&&e.keyCode<=13||e.keyCode>=32&&e.keyCode<=40||e.keyCode==46||e.keyCode>=96&&e.keyCode<=111){n.cleanCache()}}).mousedown(function(e){if(e.target.nodeName=="HTML"){r=n.rte.doc.body}else{r=e.target}i=s=null}).mouseup(function(e){if(e.target.nodeName=="HTML"){i=n.rte.doc.body}else{i=e.target}i=e.target;s=null}).click();this.collapsed=function(){return this.getRangeAt().isCollapsed()};this.collapse=function(t){var n=u(),r=this.getRangeAt();r.collapse(t?true:false);if(!e.browser.msie){n.removeAllRanges();n.addRange(r)}return this};this.getRangeAt=function(e){if(this.rte.browser.msie){if(!this.w3cRange){this.w3cRange=new this.rte.w3cRange(this.rte)}e&&this.w3cRange.update();return this.w3cRange}var t=u();var n=t.rangeCount>0?t.getRangeAt(0):this.rte.doc.createRange();n.getStart=function(){return this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(this.startOffset,this.startContainer.childNodes.length-1)]:this.startContainer};n.getEnd=function(){return this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(this.startOffset==this.endOffset?this.endOffset:this.endOffset-1,this.endContainer.childNodes.length-1)]:this.endContainer};n.isCollapsed=function(){return this.collapsed};return n};this.saveIERange=function(){if(e.browser.msie){o=this.getRangeAt().getBookmark()}};this.restoreIERange=function(){e.browser.msie&&o&&this.getRangeAt().moveToBookmark(o)};this.cloneContents=function(){var t=this.rte.dom.create("div"),n,r,i;if(e.browser.msie){try{n=this.rte.window.document.selection.createRange()}catch(s){n=this.rte.doc.body.createTextRange()}e(t).html(n.htmlText)}else{r=this.getRangeAt().cloneContents();for(i=0;i<r.childNodes.length;i++){t.appendChild(r.childNodes[i].cloneNode(true))}}return t};this.select=function(e,t){t=t||e;if(this.rte.browser.msie){var n=this.rte.doc.body.createTextRange(),r=n.duplicate(),i=n.duplicate();r.moveToElementText(e);i.moveToElementText(t);n.setEndPoint("StartToStart",r);n.setEndPoint("EndToEnd",i);n.select()}else{var s=u(),n=this.getRangeAt();n.setStartBefore(e);n.setEndAfter(t);s.removeAllRanges();s.addRange(n)}return this.cleanCache()};this.selectContents=function(e){var t=this.getRangeAt();if(e&&e.nodeType==1){if(this.rte.browser.msie){t.range();t.r.moveToElementText(e.parentNode);t.r.select()}else{try{t.selectNodeContents(e)}catch(n){return this.rte.log("unable select node contents "+e)}var r=u();r.removeAllRanges();r.addRange(t)}}return this};this.deleteContents=function(){if(!e.browser.msie){this.getRangeAt().deleteContents()}return this};this.insertNode=function(t,n){if(n&&!this.collapsed()){this.collapse()}if(this.rte.browser.msie){var r=t.nodeType==3?t.nodeValue:e(this.rte.dom.create("span")).append(e(t)).html();var i=this.getRangeAt();i.insertNode(r)}else{var i=this.getRangeAt();i.insertNode(t);i.setStartAfter(t);i.setEndAfter(t);var s=u();s.removeAllRanges();s.addRange(i)}return this.cleanCache()};this.insertHtml=function(t,n){if(n&&!this.collapsed()){this.collapse()}if(this.rte.browser.msie){this.getRangeAt().range().pasteHTML(t)}else{var r=e(this.rte.dom.create("span")).html(t||"").get(0);this.insertNode(r);this.setStartAfter(newNode);this.setEndAfter(newNode);e(r).replaceWith(e(r).html())}return this.cleanCache()};this.insertText=function(e,t){var n=this.rte.doc.createTextNode(e);return this.insertHtml(n.nodeValue)};this.getBookmark=function(){this.rte.window.focus();var t,n,r,i,s,o=this.rte.dom.createBookmark(),a=this.rte.dom.createBookmark();if(e.browser.msie){try{t=this.rte.window.document.selection.createRange()}catch(a){t=this.rte.doc.body.createTextRange()}if(t.item){var f=t.item(0);t=this.rte.doc.body.createTextRange();t.moveToElementText(f)}n=t.duplicate();r=t.duplicate();i=this.rte.dom.create("span");s=this.rte.dom.create("span");i.appendChild(o);s.appendChild(a);n.collapse(true);n.pasteHTML(i.innerHTML);r.collapse(false);r.pasteHTML(s.innerHTML)}else{var l=u();var t=l.rangeCount>0?l.getRangeAt(0):this.rte.doc.createRange();n=t.cloneRange();r=t.cloneRange();r.collapse(false);r.insertNode(a);n.collapse(true);n.insertNode(o);this.select(o,a)}return[o.id,a.id]};this.moveToBookmark=function(t){this.rte.window.focus();if(t&&t.length==2){var n=this.rte.doc.getElementById(t[0]),r=this.rte.doc.getElementById(t[1]),i,s;if(n&&r){this.select(n,r);if(this.rte.dom.next(n)==r){this.collapse(true)}if(!e.browser.msie){i=u();s=i.rangeCount>0?i.getRangeAt(0):this.rte.doc.createRange();i.removeAllRanges();i.addRange(s)}n.parentNode.removeChild(n);r.parentNode.removeChild(r)}}return this};this.removeBookmark=function(e){this.rte.window.focus();if(e.length==2){var t=this.rte.doc.getElementById(e[0]),n=this.rte.doc.getElementById(e[1]);if(t&&n){t.parentNode.removeChild(t);n.parentNode.removeChild(n)}}};this.cleanCache=function(){r=i=s=null;return this};this.getStart=function(){if(!r){var e=this.getRangeAt();r=e.getStart()}return r};this.getEnd=function(){if(!i){var e=this.getRangeAt();i=e.getEnd()}return i};this.getNode=function(){if(!s){s=this.rte.dom.findCommonAncestor(this.getStart(),this.getEnd())}return s};this.selected=function(t){function l(){function t(){for(var t=0;t<a.length;t++){if(a[t].nodeType==1&&(n.rte.dom.selfOrParent(a[t],/^P$/)||e(a[t]).find("p").length>0)){return false}}return true}if(a.length>0){var i=r.tag=="p"&&!t()?"div":r.tag;var s=n.rte.dom.wrap(a,i);u[f]=s;f=null;a=[]}}function c(t){if(t.nodeType==1){if(/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(t.nodeName)){e(t).find("td,th").each(function(){var t=r.tag=="p"&&e(this).find("p").length>0?"div":r.tag;var i=n.rte.dom.wrapContents(this,t);return u.push(i)})}else if(/^(CAPTION|TD|TH|LI|DT|DD)$/.test(t.nodeName)){var i=r.tag=="p"&&e(t).find("p").length>0?"div":r.tag;var t=n.rte.dom.wrapContents(t,i);return u.push(t)}}var s=a.length>0?a[a.length-1]:null;if(s&&s!=n.rte.dom.prev(t)){l()}a.push(t);if(f===null){f=u.length;u.push("dummy")}}var r={collapsed:false,blocks:false,filter:false,wrap:"text",tag:"span"};r=e.extend({},r,t);if(r.blocks){var i=this.getNode(),s=null;if(s=this.rte.dom.selfOrParent(i,"selectionBlock")){return[s]}}var o=this.selectedRaw(r.collapsed,r.blocks);var u=[];var a=[];var f=null;if(o.nodes.length>0){for(var h=0;h<o.nodes.length;h++){var i=o.nodes[h];if(i.nodeType==3&&(h==0||h==o.nodes.length-1)&&e.trim(i.nodeValue).length>0){if(h==0&&o.so>0){i=i.splitText(o.so)}if(h==o.nodes.length-1&&o.eo>0){i.splitText(h==0&&o.so>0?o.eo-o.so:o.eo)}}switch(r.wrap){case"text":if(i.nodeType==1&&i.nodeName=="BR"||i.nodeType==3&&e.trim(i.nodeValue).length>0){c(i)}else if(i.nodeType==1){u.push(i)}break;case"inline":if(this.rte.dom.isInline(i)){c(i)}else if(i.nodeType==1){u.push(i)}break;case"all":if(i.nodeType==1||!this.rte.dom.isEmpty(i)){c(i)}break;default:if(i.nodeType==1||!this.rte.dom.isEmpty(i)){u.push(i)}}}l()}if(u.length){this.rte.window.focus();this.select(u[0],u[u.length-1])}return r.filter?this.rte.dom.filter(u,r.filter):u};this.dump=function(e,t,n,r,i){var s=this.getRangeAt();this.rte.log("commonAncestorContainer");this.rte.log(e||s.commonAncestorContainer);this.rte.log("startContainer");this.rte.log(t||s.startContainer);this.rte.log("startOffset: "+(r>=0?r:s.startOffset));this.rte.log("endContainer");this.rte.log(n||s.endContainer);this.rte.log("endOffset: "+(i>=0?i:s.endOffset))};this.selectedRaw=function(t,r){function h(t,n,r){if(t.nodeType==3){r=r>=0?r:t.nodeValue.length;return n==0&&r==t.nodeValue.length||e.trim(t.nodeValue).length==e.trim(t.nodeValue.substring(n,r)).length}return true}function p(t,r,i){if(t.nodeType==1){return n.rte.dom.isEmpty(t)}else if(t.nodeType==3){return e.trim(t.nodeValue.substring(r||0,i>=0?i:t.nodeValue.length)).length==0}return true}var i={so:null,eo:null,nodes:[]};var s=this.getRangeAt(true);var o=s.commonAncestorContainer;var u,f;var l=false;var c=false;if(s.startContainer.nodeType==1){if(s.startOffset<s.startContainer.childNodes.length){u=s.startContainer.childNodes[s.startOffset];i.so=u.nodeType==1?null:0}else{u=s.startContainer.childNodes[s.startOffset-1];i.so=u.nodeType==1?null:u.nodeValue.length}}else{u=s.startContainer;i.so=s.startOffset}if(s.collapsed){if(t){if(r){u=a(u);if(!this.rte.dom.isEmpty(u)||(u=this.rte.dom.next(u))){i.nodes=[u]}if(this.rte.dom.isInline(u)){i.nodes=this.rte.dom.toLineStart(u).concat(i.nodes,this.rte.dom.toLineEnd(u))}if(i.nodes.length>0){i.so=i.nodes[0].nodeType==1?null:0;i.eo=i.nodes[i.nodes.length-1].nodeType==1?null:i.nodes[i.nodes.length-1].nodeValue.length}}else if(!this.rte.dom.isEmpty(u)){i.nodes=[u]}}return i}if(s.endContainer.nodeType==1){f=s.endContainer.childNodes[s.endOffset-1];i.eo=f.nodeType==1?null:f.nodeValue.length}else{f=s.endContainer;i.eo=s.endOffset}if(u.nodeType==1||r||h(u,i.so,u.nodeValue.length)){u=a(u,o,"left");l=true;i.so=u.nodeType==1?null:0}if(f.nodeType==1||r||h(f,0,i.eo)){f=a(f,o,"right");c=true;i.eo=f.nodeType==1?null:f.nodeValue.length}if(r){if(u.nodeType!=1&&u.parentNode!=o&&u.parentNode.nodeName!="BODY"){u=u.parentNode;i.so=null}if(f.nodeType!=1&&f.parentNode!=o&&f.parentNode.nodeName!="BODY"){f=f.parentNode;i.eo=null}}if(u.parentNode==f.parentNode&&u.parentNode.nodeName!="BODY"&&l&&this.rte.dom.isFirstNotEmpty(u)&&c&&this.rte.dom.isLastNotEmpty(f)){u=f=u.parentNode;i.so=u.nodeType==1?null:0;i.eo=f.nodeType==1?null:f.nodeValue.length}if(u==f){if(!this.rte.dom.isEmpty(u)){i.nodes.push(u)}return i}var d=u;while(d.nodeName!="BODY"&&d.parentNode!==o&&d.parentNode.nodeName!="BODY"){d=d.parentNode}var v=f;while(v.nodeName!="BODY"&&v.parentNode!==o&&v.parentNode.nodeName!="BODY"){v=v.parentNode}if(!p(u,i.so,u.nodeType==3?u.nodeValue.length:null)){i.nodes.push(u)}var m=u;while(m!==d){var g=m;while(g=this.rte.dom.next(g)){i.nodes.push(g)}m=m.parentNode}m=d;while((m=this.rte.dom.next(m))&&m!=v){i.nodes.push(m)}var y=[];m=f;while(m!==v){var g=m;while(g=this.rte.dom.prev(g)){y.push(g)}m=m.parentNode}if(y.length){i.nodes=i.nodes.concat(y.reverse())}if(!p(f,0,f.nodeType==3?i.eo:null)){i.nodes.push(f)}if(r){if(this.rte.dom.isInline(u)){i.nodes=this.rte.dom.toLineStart(u).concat(i.nodes);i.so=i.nodes[0].nodeType==1?null:0}if(this.rte.dom.isInline(f)){i.nodes=i.nodes.concat(this.rte.dom.toLineEnd(f));i.eo=i.nodes[i.nodes.length-1].nodeType==1?null:i.nodes[i.nodes.length-1].nodeValue.length}}return i}}})(jQuery);(function(e){elRTE.prototype.ui=function(t){this.rte=t;this._buttons=[];var n=this,r=this.rte.options.toolbars[t.options.toolbar&&t.options.toolbars[t.options.toolbar]?t.options.toolbar:"normal"],i=r.length,s,o,u,a,f,l,c;for(c in this.buttons){if(this.buttons.hasOwnProperty(c)&&c!="button"){this.buttons[c].prototype=this.buttons.button.prototype}}while(i--){first=i==0?true:false;if(r[i-1]=="eol"){first=true}o=r[i];if(o=="eol"){e(this.rte.doc.createElement("br")).prependTo(this.rte.toolbar);continue}s=e('<ul class="panel-'+o+(first?" first":"")+'" />').prependTo(this.rte.toolbar);s.bind("mousedown",function(e){e.preventDefault()});u=this.rte.options.panels[o].length;while(u--){a=this.rte.options.panels[o][u];f=this.buttons[a]||this.buttons.button;this._buttons.push(l=new f(this.rte,a));s.prepend(l.domElem)}}this.update();this.disable=function(){e.each(n._buttons,function(){!this.active&&this.domElem.addClass("disabled")})}};elRTE.prototype.ui.prototype.update=function(t){function f(t){var n=t.nodeName.toLowerCase();t=e(t);if(n=="img"){if(t.hasClass("elrte-media")){n="media"}else if(t.hasClass("elrte-google-maps")){n="google map"}else if(t.hasClass("elrte-yandex-maps")){n="yandex map"}else if(t.hasClass("elrte-pagebreak")){n="pagebreak"}}return n}t&&this.rte.selection.cleanCache();var n=this.rte.selection.getNode(),r=this.rte.dom.parents(n,"*"),i=this.rte.rtl,s=i?" &laquo; ":" &raquo; ",o="",u,a;if(n&&n.nodeType==1&&n.nodeName!="BODY"){r.unshift(n)}if(!i){r=r.reverse()}for(a=0;a<r.length;a++){o+=(a>0?s:"")+f(r[a])}this.rte.statusbar.html(o);e.each(this._buttons,function(){this.update()});this.rte.window.focus()};elRTE.prototype.ui.prototype.buttons={button:function(t,n){var r=this;this.rte=t;this.active=false;this.name=n;this.val=null;this.domElem=e('<li style="-moz-user-select:-moz-none" class="'+n+' rounded-3" name="'+n+'" title="'+this.rte.i18n(this.rte.options.buttons[n]||n)+'" unselectable="on" />').hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")}).click(function(t){t.stopPropagation();t.preventDefault();if(!e(this).hasClass("disabled")){r.command()}r.rte.window.focus()})}};elRTE.prototype.ui.prototype.buttons.button.prototype.command=function(){this.rte.history.add();try{this.rte.doc.execCommand(this.name,false,this.val)}catch(e){return this.rte.log("commands failed: "+this.name)}this.rte.ui.update(true)};elRTE.prototype.ui.prototype.buttons.button.prototype.update=function(){try{if(!this.rte.doc.queryCommandEnabled(this.name)){return this.domElem.addClass("disabled")}else{this.domElem.removeClass("disabled")}}catch(e){return}try{if(this.rte.doc.queryCommandState(this.name)){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}}catch(e){}}})(jQuery);(function(e){elRTE.prototype.utils=function(t){this.rte=t;this.url=null;this.reg=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;this.baseURL="";this.path="";this.entities={"&":"&",'"':"&quot;","<":"&lt;",">":"&gt;"};this.entitiesRegExp=/[<>&\"]/g;this.media=[{type:"application/x-shockwave-flash",classid:["clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"],codebase:"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"},{type:"application/x-director",classid:["clsid:166b1bca-3f9c-11cf-8075-444553540000"],codebase:"http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"},{type:"application/x-mplayer2",classid:["clsid:6bf52a52-394a-11d3-b153-00c04f79faa6","clsid:22d6f312-b0f6-11d0-94ab-0080c74c7e95","clsid:05589fa1-c356-11ce-bf01-00aa0055595a"],codebase:"http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"},{type:"video/quicktime",classid:["clsid:02bf25d5-8c17-4b23-bc80-d3488abddc6b"],codebase:"http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"},{type:"audio/x-pn-realaudio-plugin",classid:["clsid:cfcdaa03-8be4-11cf-b84b-0020afbbccfa"],codebase:"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"}];this.rgbRegExp=/\s*rgb\s*?\(\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?\)\s*/i;this.colorsRegExp=/aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|rgb\s*\([^\)]+\)/i;this.colors={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#fffffff",yellow:"#ffff00"};var n=this;this.rgb2hex=function(e){return this.color2Hex(""+e)};this.toPixels=function(t){var n=t.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);if(n){t=n[1];unit=n[2]}if(t[0]=="."){t="0"+t}t=parseFloat(t);if(isNaN(t)){return""}var r=parseInt(e(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(t*r);case"pt":return parseInt(t*r/12);case"%":return parseInt(t*r/100)}return t};this.absoluteURL=function(t){!this.url&&this._url();t=e.trim(t);if(!t){return""}if(t[0]=="#"){return t}var n=this.parseURL(t);if(!n.host&&!n.path&&!n.anchor){return""}if(!this.rte.options.absoluteURLs){return t}if(n.protocol){return t}if(n.host&&(n.host.indexOf(".")!=-1||n.host=="localhost")){return this.url.protocol+"://"+t}if(t[0]=="/"){t=this.baseURL+t}else{if(t.indexOf("./")==0){t=t.substring(2)}t=this.baseURL+this.path+t}return t};this.parseURL=function(t){var n=t.match(this.reg);var r={};e.each(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(e){r[this]=n[e]});if(!r.host.match(/[a-z0-9]/i)){r.host=""}return r};this.trimEventCallback=function(t){t=t?t.toString():"";return e.trim(t.replace(/\r*\n/mg,"").replace(/^function\s*on[a-z]+\s*\(\s*event\s*\)\s*\{(.+)\}$/igm,"$1"))};this._url=function(){this.url=this.parseURL(window.location.href);this.baseURL=this.url.protocol+"://"+(this.url.userInfo?parts.userInfo+"@":"")+this.url.host+(this.url.port?":"+this.url.port:"");this.path=!this.url.file?this.url.path:this.url.path.substring(0,this.url.path.length-this.url.file.length)};this.makeObject=function(t){var n={};e.each(t,function(e,t){n[t]=t});return n};this.encode=function(e){var t=this.entities;return(""+e).replace(this.entitiesRegExp,function(e){return t[e]})};this.decode=function(t){return e("<div/>").html(t||"").text()};this.parseStyle=function(t){var n={},r=this.rte.options.allowBrowsersSpecStyles,i,s,o,u;if(typeof t=="string"&&t.length){e.each(t.replace(/&quot;/gi,"'").split(";"),function(t,i){if((u=i.indexOf(":"))!==-1){s=e.trim(i.substr(0,u));o=e.trim(i.substr(u+1));if(s=="color"||s=="background-color"){o=o.toLowerCase()}if(s&&o&&(r||s.substring(0,1)!="-")){n[s]=o}}})}return n};this.compactStyle=function(t){var n=this;if(t.border=="medium none"){delete t.border}e.each(t,function(e,r){if(/color$/i.test(e)){t[e]=n.color2Hex(r)}else if(/^(border|background)$/i.test(e)){t[e]=r.replace(n.colorsRegExp,function(e){return n.color2Hex(e)})}});if(t["border-width"]){t.border=t["border-width"]+" "+(t["border-style"]||"solid")+" "+(t["border-color"]||"#000");delete t["border-width"];delete t["border-style"];delete t["border-color"]}if(t["background-image"]){t.background=t["background-color"]+" "||""+t["background-image"]+" "+t["background-position"]||"0 0"+" "+t["background-repeat"]||"repeat";delete t["background-image"];delete ["background-image"];delete ["background-position"];delete ["background-repeat"]}if(t["margin-top"]&&t["margin-right"]&&t["margin-bottom"]&&t["margin-left"]){t.margin=t["margin-top"]+" "+t["margin-right"]+" "+t["margin-bottom"]+" "+t["margin-left"];delete t["margin-top"];delete t["margin-right"];delete t["margin-bottom"];delete t["margin-left"]}if(t["padding-top"]&&t["padding-right"]&&t["padding-bottom"]&&t["padding-left"]){t.padding=t["padding-top"]+" "+t["padding-right"]+" "+t["padding-bottom"]+" "+t["padding-left"];delete t["padding-top"];delete t["padding-right"];delete t["padding-bottom"];delete t["padding-left"]}if(t["list-style-type"]||t["list-style-position"]||t["list-style-image"]){t["list-style"]=e.trim(t["list-style-type"]||" "+t["list-style-position"]||""+t["list-style-image"]||"");delete t["list-style-type"];delete t["list-style-position"];delete t["list-style-image"]}return t};this.serializeStyle=function(t,n){var r=[];e.each(n?this.compactStyle(t):t,function(e,t){t&&r.push(e+":"+t)});return r.join(";")};this.parseClass=function(t){t=e.trim(t);return t.length?this.makeObject(t.split(/\s+/)):{};return t.length?t.split(/\s+/):[]};this.serializeClass=function(t){var n=[];var r=this.rte;e.each(t,function(e){n.push(e)});return n.join(" ")};this.mediaInfo=function(t,n){var r=this.media.length;while(r--){if(t===this.media[r].type||n&&e.inArray(n,this.media[r].classid)!=-1){return this.media[r]}}};this.color2Hex=function(e){function n(e){e=parseInt(e).toString(16);return e.length>1?e:"0"+e}var t;e=e||"";if(e.indexOf("#")===0){return e}if(this.colors[e]){return this.colors[e]}if(t=e.match(this.rgbRegExp)){return"#"+n(t[1])+n(t[2])+n(t[3])}return""}}})(jQuery);(function(e){elRTE.prototype.w3cRange=function(e){var t=this;this.rte=e;this.r=null;this.collapsed=true;this.startContainer=null;this.endContainer=null;this.startOffset=0;this.endOffset=0;this.commonAncestorContainer=null;this.range=function(){try{this.r=this.rte.window.document.selection.createRange()}catch(e){this.r=this.rte.doc.body.createTextRange()}return this.r};this.insertNode=function(e){this.range();t.r.collapse(false);var n=t.r.duplicate();n.pasteHTML(e)};this.getBookmark=function(){this.range();if(this.r.item){var e=this.r.item(0);this.r=this.rte.doc.body.createTextRange();this.r.moveToElementText(e)}return this.r.getBookmark()};this.moveToBookmark=function(e){this.rte.window.focus();this.range().moveToBookmark(e);this.r.select()};this.update=function(){function e(e){var n="﻿";var r=offset=0;var i=t.r.duplicate();i.collapse(e);var s=i.parentElement();if(!s||s.nodeName=="HTML"){return{parent:t.rte.doc.body,ndx:r,offset:offset}}i.pasteHTML(n);childs=s.childNodes;for(var o=0;o<childs.length;o++){var u=childs[o];if(o>0&&(u.nodeType!==3||childs[o-1].nodeType!==3)){r++}if(u.nodeType!==3){offset=0}else{var a=u.nodeValue.indexOf(n);if(a!==-1){offset+=a;break}offset+=u.nodeValue.length}}i.moveStart("character",-1);i.text="";return{parent:s,ndx:Math.min(r,s.childNodes.length-1),offset:offset}}this.range();this.startContainer=this.endContainer=null;if(this.r.item){this.collapsed=false;var n=this.r.item(0);this.setStart(n.parentNode,this.rte.dom.indexOf(n));this.setEnd(n.parentNode,this.startOffset+1)}else{this.collapsed=this.r.boundingWidth==0;var r=e(true);var i=e(false);r.parent.normalize();i.parent.normalize();r.ndx=Math.min(r.ndx,r.parent.childNodes.length-1);i.ndx=Math.min(i.ndx,i.parent.childNodes.length-1);if(r.parent.childNodes[r.ndx].nodeType&&r.parent.childNodes[r.ndx].nodeType==1){this.setStart(r.parent,r.ndx)}else{this.setStart(r.parent.childNodes[r.ndx],r.offset)}if(i.parent.childNodes[i.ndx].nodeType&&i.parent.childNodes[i.ndx].nodeType==1){this.setEnd(i.parent,i.ndx)}else{this.setEnd(i.parent.childNodes[i.ndx],i.offset)}this.select()}return this};this.isCollapsed=function(){this.range();this.collapsed=this.r.item?false:this.r.boundingWidth==0;return this.collapsed};this.collapse=function(e){this.range();if(this.r.item){var t=this.r.item(0);this.r=this.rte.doc.body.createTextRange();this.r.moveToElementText(t)}this.r.collapse(e);this.r.select();this.collapsed=true};this.getStart=function(){this.range();if(this.r.item){return this.r.item(0)}var e=this.r.duplicate();e.collapse(true);var t=e.parentElement();return t&&t.nodeName=="BODY"?t.firstChild:t};this.getEnd=function(){this.range();if(this.r.item){return this.r.item(0)}var e=this.r.duplicate();e.collapse(false);var t=e.parentElement();return t&&t.nodeName=="BODY"?t.lastChild:t};this.setStart=function(e,t){this.startContainer=e;this.startOffset=t;if(this.endContainer){this.commonAncestorContainer=this.rte.dom.findCommonAncestor(this.startContainer,this.endContainer)}};this.setEnd=function(e,t){this.endContainer=e;this.endOffset=t;if(this.startContainer){this.commonAncestorContainer=this.rte.dom.findCommonAncestor(this.startContainer,this.endContainer)}};this.setStartBefore=function(e){if(e.parentNode){this.setStart(e.parentNode,this.rte.dom.indexOf(e))}};this.setStartAfter=function(e){if(e.parentNode){this.setStart(e.parentNode,this.rte.dom.indexOf(e)+1)}};this.setEndBefore=function(e){if(e.parentNode){this.setEnd(e.parentNode,this.rte.dom.indexOf(e))}};this.setEndAfter=function(e){if(e.parentNode){this.setEnd(e.parentNode,this.rte.dom.indexOf(e)+1)}};this.select=function(){function e(e,n){if(e.nodeType!=3){return-1}var r="﻿";var i=e.nodeValue;var s=t.rte.doc.body.createTextRange();e.nodeValue=i.substring(0,n)+r+i.substring(n);s.moveToElementText(e.parentNode);s.findText(r);var o=Math.abs(s.moveStart("character",-1048575));e.nodeValue=i;return o}this.r=this.rte.doc.body.createTextRange();var n=this.startOffset;var r=this.endOffset;var i=this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(n,this.startContainer.childNodes.length-1)]:this.startContainer;var s=this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(n==r?r:r-1,this.endContainer.childNodes.length-1)]:this.endContainer;if(this.collapsed){if(i.nodeType==3){var o=e(i,n);this.r.move("character",o)}else{this.r.moveToElementText(i);this.r.collapse(true)}}else{var u=this.rte.doc.body.createTextRange();var a=e(i,n);var f=e(s,r);if(i.nodeType==3){this.r.move("character",a)}else{this.r.moveToElementText(i)}if(s.nodeType==3){u.move("character",f)}else{u.moveToElementText(s)}this.r.setEndPoint("EndToEnd",u)}try{this.r.select()}catch(s){}if(u){u=null}};this.dump=function(){this.rte.log("collapsed: "+this.collapsed);this.rte.log("startContainer: "+(this.startContainer?this.startContainer.nodeName:"non"));this.rte.log("startOffset: "+this.startOffset);this.rte.log("endContainer: "+(this.endContainer?this.endContainer.nodeName:"none"));this.rte.log("endOffset: "+this.endOffset)}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.about=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.active=true;this.command=function(){var n,r,i;n={rtl:t.rtl,submit:function(e,t){t.close()},dialog:{width:560,title:this.rte.i18n("About this software"),buttons:{Ok:function(){e(this).dialog("destroy")}}}};i='<div class="elrte-logo"></div><h3>'+this.rte.i18n("About elRTE")+'</h3><br clear="all"/>'+'<div class="elrte-ver">'+this.rte.i18n("Version")+": "+this.rte.version+" ("+this.rte.build+")</div>"+'<div class="elrte-ver">jQuery: '+e("<div/>").jquery+"</div>"+'<div class="elrte-ver">jQueryUI: '+e.ui.version+"</div>"+'<div class="elrte-ver">'+this.rte.i18n("Licence")+": BSD Licence</div>"+"<p>"+this.rte.i18n("elRTE is an open-source JavaScript based WYSIWYG HTML-editor.")+"<br/>"+this.rte.i18n("Main goal of the editor - simplify work with text and formating (HTML) on sites, blogs, forums and other online services.")+"<br/>"+this.rte.i18n("You can use it in any commercial or non-commercial projects.")+"</p>"+"<h4>"+this.rte.i18n("Authors")+"</h4>"+'<table class="elrte-authors">'+"<tr><td>Dmitry (dio) Levashov &lt;dio@std42.ru&gt;</td><td>"+this.rte.i18n("Chief developer")+"</td></tr>"+"<tr><td>Troex Nevelin &lt;troex@fury.scancode.ru&gt;</td><td>"+this.rte.i18n("Developer, tech support")+"</td></tr>"+"<tr><td>Valentin Razumnyh &lt;content@std42.ru&gt;</td><td>"+this.rte.i18n("Interface designer")+"</td></tr>"+"<tr><td>Tawfek Daghistani &lt;tawfekov@gmail.com&gt;</td><td>"+this.rte.i18n("RTL support")+"</td></tr>"+(this.rte.options.lang!="en"?"<tr><td>"+this.rte.i18n("_translator")+"</td><td>"+this.rte.i18n("_translation")+"</td></tr>":"")+"</table>"+'<div class="elrte-copy">Copyright &copy; 2009-2011, <a href="http://www.std42.ru">Studio 42</a></div>'+'<div class="elrte-copy">'+this.rte.i18n("For more information about this software visit the")+' <a href="http://elrte.org">'+this.rte.i18n("elRTE website")+".</a></div>"+'<div class="elrte-copy">Twitter: <a href="http://twitter.com/elrte_elfinder">elrte_elfinder</a></div>';r=new elDialogForm(n);r.append(i);r.open()};this.update=function(){this.domElem.removeClass("disabled")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.anchor=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.input=e('<input type="text" />').attr("name","anchor").attr("size","16");var r=this;this.command=function(){var n={rtl:this.rte.rtl,submit:function(e,t){e.stopPropagation();e.preventDefault();t.close();r.set()},dialog:{title:this.rte.i18n("Bookmark")}};this.anchor=this.rte.dom.selfOrParentAnchor(this.rte.selection.getEnd())||t.dom.create("a");!this.rte.selection.collapsed()&&this.rte.selection.collapse(false);this.input.val(e(this.anchor).addClass("elrte-anchor").attr("name"));this.rte.selection.saveIERange();var i=new elDialogForm(n);i.append([this.rte.i18n("Bookmark name"),this.input],null,true).open();setTimeout(function(){r.input.focus()},20)};this.update=function(){var e=this.rte.selection.getNode();if(this.rte.dom.selfOrParentLink(e)){this.domElem.addClass("disabled")}else if(this.rte.dom.selfOrParentAnchor(e)){this.domElem.removeClass("disabled").addClass("active")}else{this.domElem.removeClass("disabled").removeClass("active")}};this.set=function(){var t=e.trim(this.input.val());if(t){this.rte.history.add();if(!this.anchor.parentNode){this.rte.selection.insertHtml('<a name="'+t+'" title="'+this.rte.i18n("Bookmark")+": "+t+'" class="elrte-anchor"></a>')}else{this.anchor.name=t;this.anchor.title=this.rte.i18n("Bookmark")+": "+t}}else if(this.anchor.parentNode){this.rte.history.add();this.anchor.parentNode.removeChild(this.anchor)}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.blockquote=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.command=function(){var t,n;this.rte.history.add();if(this.rte.selection.collapsed()&&(t=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^BLOCKQUOTE$/))){e(t).replaceWith(e(t).html())}else{n=this.rte.selection.selected({wrap:"all",tag:"blockquote"});n.length&&this.rte.selection.select(n[0],n[n.length-1])}this.rte.ui.update(true)};this.update=function(){if(this.rte.selection.collapsed()){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^BLOCKQUOTE$/)){this.domElem.removeClass("disabled").addClass("active")}else{this.domElem.addClass("disabled").removeClass("active")}}else{this.domElem.removeClass("disabled active")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.copy=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.command=function(){if(this.rte.browser.mozilla){try{this.rte.doc.execCommand(this.name,false,null)}catch(t){var n=" Ctl + C";if(this.name=="cut"){n=" Ctl + X"}else if(this.name=="paste"){n=" Ctl + V"}var r={dialog:{title:this.rte.i18n("Warning"),buttons:{Ok:function(){e(this).dialog("close")}}}};var i=new elDialogForm(r);i.append(this.rte.i18n("This operation is disabled in your browser on security reason. Use shortcut instead.")+": "+n).open()}}else{this.constructor.prototype.command.call(this)}}};elRTE.prototype.ui.prototype.buttons.cut=elRTE.prototype.ui.prototype.buttons.copy;elRTE.prototype.ui.prototype.buttons.paste=elRTE.prototype.ui.prototype.buttons.copy})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.css=function(t,n){var r=this;this.constructor.prototype.constructor.call(this,t,n);this.cssStyle=e('<input type="text" size="42" name="style" />');this.cssClass=e('<input type="text" size="42" name="class" />');this.elementID=e('<input type="text" size="42" name="id" />');this.command=function(){var t=this.node(),n;this.rte.selection.saveIERange();if(t){var n={submit:function(e,t){e.stopPropagation();e.preventDefault();t.close();r.set()},dialog:{title:this.rte.i18n("Style"),width:450,resizable:true,modal:true}};this.cssStyle.val(e(t).attr("style"));this.cssClass.val(e(t).attr("class"));this.elementID.val(e(t).attr("id"));var i=new elDialogForm(n);i.append([this.rte.i18n("Css style"),this.cssStyle],null,true);i.append([this.rte.i18n("Css class"),this.cssClass],null,true);i.append([this.rte.i18n("ID"),this.elementID],null,true);i.open();setTimeout(function(){r.cssStyle.focus()},20)}};this.set=function(){var t=this.node();this.rte.selection.restoreIERange();if(t){e(t).attr("style",this.cssStyle.val());e(t).attr("class",this.cssClass.val());e(t).attr("id",this.elementID.val());this.rte.ui.update()}};this.node=function(){var e=this.rte.selection.getNode();if(e.nodeType==3){e=e.parentNode}return e.nodeType==1&&e.nodeName!="BODY"?e:null};this.update=function(){this.domElem.toggleClass("disabled",this.node()?false:true)}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.rtl=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.command=function(){var t=this.rte.selection.getNode(),n=this;if(e(t).attr("dir")=="rtl"||e(t).parents('[dir="rtl"]').length||e(t).find('[dir="rtl"]').length){e(t).removeAttr("dir");e(t).parents('[dir="rtl"]').removeAttr("dir");e(t).find('[dir="rtl"]').removeAttr("dir")}else{if(this.rte.dom.is(t,"textNodes")&&this.rte.dom.is(t,"block")){e(t).attr("dir","rtl")}else{e.each(this.rte.dom.parents(t,"textNodes"),function(t,r){if(n.rte.dom.is(r,"block")){e(r).attr("dir","rtl");return false}})}}this.rte.ui.update()};this.update=function(){var t=this.rte.selection.getNode();this.domElem.removeClass("disabled");if(e(t).attr("dir")=="rtl"||e(t).parents('[dir="rtl"]').length||e(t).find('[dir="rtl"]').length){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}}};elRTE.prototype.ui.prototype.buttons.ltr=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.command=function(){var t=this.rte.selection.getNode(),n=this;if(e(t).attr("dir")=="ltr"||e(t).parents('[dir="ltr"]').length||e(t).find('[dir="ltr"]').length){e(t).removeAttr("dir");e(t).parents('[dir="ltr"]').removeAttr("dir");e(t).find('[dir="ltr"]').removeAttr("dir")}else{if(this.rte.dom.is(t,"textNodes")&&this.rte.dom.is(t,"block")){e(t).attr("dir","ltr")}else{e.each(this.rte.dom.parents(t,"textNodes"),function(t,r){if(n.rte.dom.is(r,"block")){e(r).attr("dir","ltr");return false}})}}this.rte.ui.update()};this.update=function(){var t=this.rte.selection.getNode();this.domElem.removeClass("disabled");if(e(t).attr("dir")=="ltr"||e(t).parents('[dir="ltr"]').length||e(t).find('[dir="ltr"]').length){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.div=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.command=function(){var t,n;this.rte.history.add();if(this.rte.selection.collapsed()){t=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^DIV$/);if(t){e(t).replaceWith(e(t).html())}}else{n=this.rte.selection.selected({wrap:"all",tag:"div"});n.length&&this.rte.selection.select(n[0],n[n.length-1])}this.rte.ui.update(true)};this.update=function(){if(this.rte.selection.collapsed()){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^DIV$/)){this.domElem.removeClass("disabled").addClass("active")}else{this.domElem.addClass("disabled active")}}else{this.domElem.removeClass("disabled active")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.docstructure=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.command=function(){this.domElem.toggleClass("active");e(this.rte.doc.body).toggleClass("el-rte-structure")};this.command();this.update=function(){this.domElem.removeClass("disabled")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.elfinder=function(e,t){this.constructor.prototype.constructor.call(this,e,t);var n=this,e=this.rte;this.command=function(){if(n.rte.options.fmAllow&&typeof n.rte.options.fmOpen=="function"){n.rte.options.fmOpen(function(t){var n=decodeURIComponent(t.split("/").pop().replace(/\+/g," "));if(e.selection.collapsed()){e.selection.insertHtml('<a href="'+t+'" >'+n+"</a>")}else{e.doc.execCommand("createLink",false,t)}})}};this.update=function(){if(n.rte.options.fmAllow&&typeof n.rte.options.fmOpen=="function"){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.flash=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.swf=null;this.placeholder=null;this.src={url:e('<input type="text" name="url" />').css("width","99%"),type:e('<select name="type"/>').append('<option value="application/x-shockwave-flash">Flash</option>').append('<option value="video/quicktime">Quicktime movie</option>').append('<option value="application/x-mplayer2">Windows media</option>'),width:e('<input type="text" />').attr("size",5).css("text-align","right"),height:e('<input type="text" />').attr("size",5).css("text-align","right"),wmode:e("<select />").append(e("<option />").val("").text(this.rte.i18n("Not set","dialogs"))).append(e("<option />").val("transparent").text(this.rte.i18n("Transparent"))),align:e("<select />").append(e("<option />").val("").text(this.rte.i18n("Not set","dialogs"))).append(e("<option />").val("left").text(this.rte.i18n("Left"))).append(e("<option />").val("right").text(this.rte.i18n("Right"))).append(e("<option />").val("top").text(this.rte.i18n("Top"))).append(e("<option />").val("text-top").text(this.rte.i18n("Text top"))).append(e("<option />").val("middle").text(this.rte.i18n("middle"))).append(e("<option />").val("baseline").text(this.rte.i18n("Baseline"))).append(e("<option />").val("bottom").text(this.rte.i18n("Bottom"))).append(e("<option />").val("text-bottom").text(this.rte.i18n("Text bottom"))),margin:e("<div />")};this.command=function(){var t=this.rte.selection.getEnd(),n,i="",s="",o="",u,a,f,c,h,p;this.rte.selection.saveIERange();this.src.margin.elPaddingInput({type:"margin"});this.placeholder=null;this.swf=null;if(e(t).hasClass("elrte-media")&&(c=e(t).attr("rel"))&&this.rte.filter.scripts[c]){this.placeholder=e(t);h=this.rte.filter.scripts[c];i="";if(h.embed&&h.embed.src){i=h.embed.src}if(h.params&&h.params.length){l=h.params.length;while(l--){if(h.params[l].name=="src"||h.params[l].name=="movie"){i=h.params[l].value}}}if(h.embed){s=h.embed.width||parseInt(h.embed.style.width)||"";o=h.embed.height||parseInt(h.embed.style.height)||"";p=h.embed.wmode||""}else if(h.obj){s=h.obj.width||parseInt(h.obj.style.width)||"";o=h.obj.height||parseInt(h.obj.style.height)||"";p=h.obj.wmode||""}if(h.obj){u=h.obj.style["float"]||"";a=h.obj.style["vertical-align"]||""}else if(h.embed){u=h.embed.style["float"]||"";a=h.embed.style["vertical-align"]||""}this.src.margin.val(t);this.src.type.val(h.embed?h.embed.type:"")}if(e(t).hasClass("elrte-swf-placeholder")){this.placeholder=e(t);i=e(t).attr("rel");s=parseInt(e(t).css("width"))||"";o=parseInt(e(t).css("height"))||"";u=e(t).css("float");a=e(t).css("vertical-align");this.src.margin.val(t);this.src.wmode.val(e(t).attr("wmode"))}this.src.url.val(i);this.src.width.val(s);this.src.height.val(o);this.src.align.val(u||a);this.src.wmode.val(p);var n={rtl:this.rte.rtl,submit:function(e,t){e.stopPropagation();e.preventDefault();r.set();t.close()},dialog:{width:580,position:"top",title:this.rte.i18n("Flash")}};var f=new elDialogForm(n);if(this.rte.options.fmAllow&&this.rte.options.fmOpen){var d=e("<span />").append(this.src.url.css("width","85%")).append(e("<span />").addClass("ui-state-default ui-corner-all").css({"float":"right","margin-right":"3px"}).attr("title",r.rte.i18n("Open file manger")).append(e("<span />").addClass("ui-icon ui-icon-folder-open")).click(function(){r.rte.options.fmOpen(function(e){r.src.url.val(e).change()})}).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}))}else{var d=this.src.url}f.append([this.rte.i18n("URL"),d],null,true);f.append([this.rte.i18n("Type"),this.src.type],null,true);f.append([this.rte.i18n("Size"),e("<span />").append(this.src.width).append(" x ").append(this.src.height).append(" px")],null,true);f.append([this.rte.i18n("Wmode"),this.src.wmode],null,true);f.append([this.rte.i18n("Alignment"),this.src.align],null,true);f.append([this.rte.i18n("Margins"),this.src.margin],null,true);f.open();var v=e("<fieldset />").append(e("<legend />").text(this.rte.i18n("Preview")));f.append(v,"main");var m=document.createElement("iframe");e(m).attr("src","#").addClass("el-rte-preview").appendTo(v);html=this.rte.options.doctype+'<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /></head><body style="padding:0;margin:0;font-size:9px"> Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin</body></html>';m.contentWindow.document.open();m.contentWindow.document.write(html);m.contentWindow.document.close();this.frame=m.contentWindow.document;this.preview=e(m.contentWindow.document.body);this.src.type.change(function(){r.src.url.change()});this.src.width.change(function(){if(r.swf){var t=parseInt(e(this).val())||"";e(this).val(t);r.swf.css("width",t);r.swf.children("embed").css("width",t)}else{e(this).val("")}});this.src.height.change(function(){if(r.swf){var t=parseInt(e(this).val())||"";e(this).val(t);r.swf.css("height",t);r.swf.children("embed").css("height",t)}else{e(this).val("")}});this.src.wmode.change(function(){if(r.swf){var t=e(this).val();if(t){r.swf.attr("wmode",t);r.swf.children("embed").attr("wmode",t)}else{r.swf.removeAttr("wmode");r.swf.children("embed").removeAttr("wmode")}}});this.src.align.change(function(){var t=e(this).val(),n=t=="left"||t=="right";if(r.swf){r.swf.css({"float":n?t:"","vertical-align":n?"":t})}else{e(this).val("")}});this.src.margin.change(function(){if(r.swf){var e=r.src.margin.val();if(e.css){r.swf.css("margin",e.css)}else{r.swf.css("margin-top",e.top);r.swf.css("margin-right",e.right);r.swf.css("margin-bottom",e.bottom);r.swf.css("margin-left",e.left)}}});this.src.url.change(function(){var t=r.rte.utils.absoluteURL(e(this).val()),n,i;if(t){n=r.rte.utils.mediaInfo(r.src.type.val());if(!n){n=r.rte.util.mediaInfo("application/x-shockwave-flash")}i='<object classid="'+n.classid+'" codebase="'+n.codebase+'"><param name="src" value="'+t+'" /><embed quality="high" src="'+t+'" type="'+n.type+'"></object>';r.preview.children("object").remove().end().prepend(i);r.swf=r.preview.children("object").eq(0)}else if(r.swf){r.swf.remove();r.swf=null}r.src.width.trigger("change");r.src.height.trigger("change");r.src.align.trigger("change")}).trigger("change")};this.set=function(){r.swf=null;var t=this.rte.utils.absoluteURL(this.src.url.val()),n=parseInt(this.src.width.val())||"",s=parseInt(this.src.height.val())||"",o=this.src.wmode.val(),u=this.src.align.val(),a=u=="left"||u=="right"?u:"",f=this.placeholder?this.placeholder.attr("rel"):"",l,c,h,p=this.src.margin.val(),d;if(!t){if(this.placeholder){this.placeholder.remove();delete this.rte.filter.scripts[f]}}else{i=r.rte.utils.mediaInfo(r.src.type.val());if(!i){i=r.rte.util.mediaInfo("application/x-shockwave-flash")}h=this.rte.filter.videoHostRegExp.test(t)?t.replace(this.rte.filter.videoHostRegExp,"$2"):i.type.replace(/^\w+\/(.+)/,"$1");l={obj:{classid:i.classid[0],codebase:i.codebase,style:{}},params:[{name:"src",value:t}],embed:{src:t,type:i.type,quality:"high",wmode:o,style:{}}};if(n){l.obj.width=n;l.embed.width=n}if(s){l.obj.height=s;l.embed.height=s}if(a){l.obj.style["float"]=a}else if(u){l.obj.style["vertical-align"]=u}if(p.css){d={margin:p.css}}else{d={"margin-top":p.top,"margin-right":p.right,"margin-bottom":p.bottom,"margin-left":p.left}}l.obj.style=e.extend({},l.obj.style,d);if(this.placeholder&&f){c=this.rte.filter.scripts[f]||{};l=e.extend(true,c,l);delete l.obj.style.width;delete l.obj.style.height;delete l.embed.style.width;delete l.embed.style.height;this.rte.filter.scripts[f]=l;this.placeholder.removeAttr("class")}else{var v="media"+Math.random().toString().substring(2);this.rte.filter.scripts[v]=l;this.placeholder=e(this.rte.dom.create("img")).attr("rel",v).attr("src",this.rte.filter.url+"pixel.gif");var m=true}this.placeholder.attr("title",this.rte.utils.encode(t)).attr("width",n||150).attr("height",s||100).addClass("elrte-protected elrte-media elrte-media-"+h).css(l.obj.style);if(a){this.placeholder.css("float",a).css("vertical-align","")}else if(u){this.placeholder.css("float","").css("vertical-align",u)}else{this.placeholder.css("float","").css("vertical-align","")}if(m){this.rte.window.focus();this.rte.selection.restoreIERange();this.rte.selection.insertNode(this.placeholder.get(0))}}};this.update=function(){this.domElem.removeClass("disabled");var t=this.rte.selection.getNode();this.domElem.toggleClass("active",t&&t.nodeName=="IMG"&&e(t).hasClass("elrte-media"))}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.fontname=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;var i={tpl:'<span style="font-family:%val">%label</span>',select:function(e){r.set(e)},src:{"":this.rte.i18n("Font"),"andale mono,sans-serif":"Andale Mono","arial,helvetica,sans-serif":"Arial","arial black,gadget,sans-serif":"Arial Black","book antiqua,palatino,sans-serif":"Book Antiqua","comic sans ms,cursive":"Comic Sans MS","courier new,courier,monospace":"Courier New","georgia,palatino,serif":"Georgia","helvetica,sans-serif":"Helvetica","impact,sans-serif":"Impact","lucida console,monaco,monospace":"Lucida console","lucida sans unicode,lucida grande,sans-serif":"Lucida grande","tahoma,sans-serif":"Tahoma","times new roman,times,serif":"Times New Roman","trebuchet ms,lucida grande,verdana,sans-serif":"Trebuchet MS","verdana,geneva,sans-serif":"Verdana"}};this.select=this.domElem.elSelect(i);this.command=function(){};this.set=function(t){this.rte.history.add();var n=this.rte.selection.selected({filter:"textContainsNodes"});e.each(n,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?e(this).find("td,th"):e(this);e(this).css("font-family",t).find("[style]").css("font-family","")});this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled");var t=this.rte.selection.getNode();if(t.nodeType!=1){t=t.parentNode}var n=e(t).css("font-family");n=n?n.toString().toLowerCase().replace(/,\s+/g,",").replace(/'|"/g,""):"";this.select.val(i.src[n]?n:"")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.fontsize=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;var i={labelTpl:"%label",tpl:'<span style="font-size:%val;line-height:1.2em">%label</span>',select:function(e){r.set(e)},src:{"":this.rte.i18n("Font size"),"xx-small":this.rte.i18n("Small (8pt)"),"x-small":this.rte.i18n("Small (10px)"),small:this.rte.i18n("Small (12pt)"),medium:this.rte.i18n("Normal (14pt)"),large:this.rte.i18n("Large (18pt)"),"x-large":this.rte.i18n("Large (24pt)"),"xx-large":this.rte.i18n("Large (36pt)")}};this.select=this.domElem.elSelect(i);this.command=function(){};this.set=function(t){this.rte.history.add();var n=this.rte.selection.selected({filter:"textContainsNodes"});e.each(n,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?e(this).find("td,th"):e(this);$this.css("font-size",t).find("[style]").css("font-size","")});this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled");var e=this.rte.selection.getNode();this.select.val((m=this.rte.dom.attr(e,"style").match(/font-size:\s*([^;]+)/i))?m[1]:"")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.forecolor=function(t,n){var r=this;this.constructor.prototype.constructor.call(this,t,n);var i={"class":"",palettePosition:"outer",color:this.defaultColor,update:function(e){r.indicator.css("background-color",e)},change:function(e){r.set(e)}};this.defaultColor=this.name=="forecolor"?"#000000":"#ffffff";this.picker=this.domElem.elColorPicker(i);this.indicator=e("<div />").addClass("color-indicator").prependTo(this.domElem);this.command=function(){};this.set=function(t){if(!this.rte.selection.collapsed()){this.rte.history.add();var n=this.rte.selection.selected({collapse:false,wrap:"text"}),r=this.name=="forecolor"?"color":"background-color";e.each(n,function(){if(/^(THEAD|TBODY|TFOOT|TR)$/.test(this.nodeName)){e(this).find("td,th").each(function(){e(this).css(r,t).find("*").css(r,"")})}else{e(this).css(r,t).find("*").css(r,"")}});this.rte.ui.update(true)}};this.update=function(){this.domElem.removeClass("disabled");var t=this.rte.selection.getNode();this.picker.val(this.rte.utils.rgb2hex(e(t.nodeType!=1?t.parentNode:t).css(this.name=="forecolor"?"color":"background-color"))||this.defaultColor)}};elRTE.prototype.ui.prototype.buttons.hilitecolor=elRTE.prototype.ui.prototype.buttons.forecolor})(jQuery);(function(t){elRTE.prototype.ui.prototype.buttons.formatblock=function(n,r){this.constructor.prototype.constructor.call(this,n,r);var i=this.rte.browser.msie?function(e){o.val=e;o.constructor.prototype.command.call(o)}:function(e){o.ieCommand(e)};var o=this;var u={labelTpl:"%label",tpls:{"":"%label"},select:function(e){o.formatBlock(e)},src:{span:this.rte.i18n("Format"),h1:this.rte.i18n("Heading 1"),h2:this.rte.i18n("Heading 2"),h3:this.rte.i18n("Heading 3"),h4:this.rte.i18n("Heading 4"),h5:this.rte.i18n("Heading 5"),h6:this.rte.i18n("Heading 6"),p:this.rte.i18n("Paragraph"),address:this.rte.i18n("Address"),pre:this.rte.i18n("Preformatted"),div:this.rte.i18n("Normal (DIV)")}};this.select=this.domElem.elSelect(u);this.command=function(){};this.formatBlock=function(n){function r(e,n){function r(e){t(e).find("h1,h2,h3,h4,h5,h6,p,address,pre").each(function(){t(this).replaceWith(t(this).html())});return e}if(/^(LI|DT|DD|TD|TH|CAPTION)$/.test(e.nodeName)){!o.rte.dom.isEmpty(e)&&o.rte.dom.wrapContents(r(e),n)}else if(/^(UL|OL|DL|TABLE)$/.test(e.nodeName)){o.rte.dom.wrap(e,n)}else{!o.rte.dom.isEmpty(e)&&t(r(e)).replaceWith(t(o.rte.dom.create(n)).html(t(e).html()))}}this.rte.history.add();var i=n.toUpperCase(),u,a,f,c=this.rte.selection.collapsed(),h=this.rte.selection.getBookmark(),p=this.rte.selection.selected({collapsed:true,blocks:true,filter:"textContainsNodes",wrap:"inline",tag:"span"});l=p.length,s=t(p[0]).prev(),e=t(p[p.length-1]).next();while(l--){a=p[l];f=t(a);if(i=="DIV"||i=="SPAN"){if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(a.nodeName)){f.replaceWith(t(this.rte.dom.create("div")).html(f.html()||""))}}else{if(/^(THEAD|TBODY|TFOOT|TR)$/.test(a.nodeName)){f.find("td,th").each(function(){r(this,i)})}else if(a.nodeName!=i){r(a,i)}}}this.rte.selection.moveToBookmark(h);this.rte.ui.update(true)};this.update=function(){this.domElem.removeClass("disabled");var e=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(H[1-6]|P|ADDRESS|PRE)$/);this.select.val(e?e.nodeName.toLowerCase():"span")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.fullscreen=function(t,n){function i(){r.wz.height(e(window).height()-r.delta);r.rte.updateHeight()}var r=this;this.constructor.prototype.constructor.call(this,t,n);this.active=true;this.editor=t.editor;this.wz=t.workzone;this.height=0;this.delta=0;this._class="el-fullscreen";setTimeout(function(){r.height=r.wz.height();r.delta=r.editor.outerHeight()-r.height},50);this.command=function(){function d(){if(c){h=l.getBookmark()}}function v(){if(c){r.wz.children().toggle();r.rte.source.focus();r.wz.children().toggle();l.moveToBookmark(h)}}var t=e(window),n=this.editor,s=n.parents().filter(function(t,n){return!/^(html|body)$/i.test(n.nodeName)&&e(n).css("position")=="relative"}),o=this.wz,u=this._class,a=n.hasClass(u),f=this.rte,l=this.rte.selection,c=e.browser.mozilla,h,p;d();s.css("position",a?"relative":"static");if(a){n.removeClass(u);o.height(this.height);t.unbind("resize",i);this.domElem.removeClass("active")}else{n.addClass(u).removeAttr("style");o.height(t.height()-this.delta).css("width","100%");t.bind("resize",i);this.domElem.addClass("active")}f.updateHeight();f.resizable(a);v()};this.update=function(){this.domElem.removeClass("disabled")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.horizontalrule=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.src={width:e('<input type="text" />').attr({name:"width",size:4}).css("text-align","right"),wunit:e("<select />").attr("name","wunit").append(e("<option />").val("%").text("%")).append(e("<option />").val("px").text("px")).val("%"),height:e('<input type="text" />').attr({name:"height",size:4}).css("text-align","right"),bg:e("<div />"),border:e("<div />"),"class":e('<input type="text" />').css("width","100%"),style:e('<input type="text" />').css("width","100%")};this.command=function(){this.src.bg.elColorPicker({palettePosition:"outer","class":"el-colorpicker ui-icon ui-icon-pencil"});var n=this.rte.selection.getEnd();this.hr=n.nodeName=="HR"?e(n):e(t.doc.createElement("hr")).css({width:"100%",height:"1px"});this.src.border.elBorderSelect({styleHeight:73,value:this.hr});var i=this.hr.css("width")||this.hr.attr("width");this.src.width.val(parseInt(i)||100);this.src.wunit.val(i.indexOf("px")!=-1?"px":"%");this.src.height.val(this.rte.utils.toPixels(this.hr.css("height")||this.hr.attr("height"))||1);this.src.bg.val(this.rte.utils.color2Hex(this.hr.css("background-color")));this.src["class"].val(this.rte.dom.attr(this.hr,"class"));this.src.style.val(this.rte.dom.attr(this.hr,"style"));var s={rtl:this.rte.rtl,submit:function(e,t){e.stopPropagation();e.preventDefault();r.set();t.close()},dialog:{title:this.rte.i18n("Horizontal rule")}};var o=new elDialogForm(s);o.append([this.rte.i18n("Width"),e("<span />").append(this.src.width).append(this.src.wunit)],null,true).append([this.rte.i18n("Height"),e("<span />").append(this.src.height).append(" px")],null,true).append([this.rte.i18n("Border"),this.src.border],null,true).append([this.rte.i18n("Background"),this.src.bg],null,true).append([this.rte.i18n("Css class"),this.src["class"]],null,true).append([this.rte.i18n("Css style"),this.src.style],null,true).open()};this.update=function(){this.domElem.removeClass("disabled");if(this.rte.selection.getEnd().nodeName=="HR"){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}};this.set=function(){this.rte.history.add();!this.hr.parentNode&&this.rte.selection.insertNode(this.hr.get(0));var e={noshade:true,style:this.src.style.val()};var t=this.src.border.val();var n={width:(parseInt(this.src.width.val())||100)+this.src.wunit.val(),height:parseInt(this.src.height.val())||1,"background-color":this.src.bg.val(),border:t.width&&t.style?t.width+" "+t.style+" "+t.color:""};this.hr.removeAttr("class").removeAttr("style").removeAttr("width").removeAttr("height").removeAttr("align").attr(e).css(n);if(this.src["class"].val()){this.hr.attr("class",this.src["class"].val())}this.rte.ui.update()}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.image=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this,t=r.rte,i=0,s=0,o=0,u=null,a=function(t){e.each(r.src,function(n,r){e.each(r,function(e,n){if(e=="src"&&t){return}n.val("")})})},f=function(n){e.each(r.src,function(r,i){e.each(i,function(e,i){var s,o,u,a,f;if(e=="width"){s=n.width()}else if(e=="height"){s=n.height()}else if(e=="border"){s="";f=n.css("border")||t.utils.parseStyle(n.attr("style")).border||"";if(f){o=f.match(/(\d(px|em|%))/);u=f.match(/(#[a-z0-9]+)/);s={width:o?o[1]:f,style:f,color:t.utils.color2Hex(u?u[1]:f)}}}else if(e=="margin"){s=n}else if(e=="align"){s=n.css("float");if(s!="left"&&s!="right"){s=n.css("vertical-align")}}else{s=n.attr(e)||""}if(r=="events"){s=t.utils.trimEventCallback(s)}i.val(s)})})},l=function(){var t=r.src.main.src.val();a(true);if(!t){r.preview.children("img").remove();r.prevImg=null}else{if(r.prevImg){r.prevImg.removeAttr("src").removeAttr("style").removeAttr("class").removeAttr("id").removeAttr("title").removeAttr("alt").removeAttr("longdesc");e.each(r.src.events,function(e,t){r.prevImg.removeAttr(e)})}else{r.prevImg=e("<img/>").prependTo(r.preview)}r.prevImg.load(function(){r.prevImg.unbind("load");setTimeout(function(){s=r.prevImg.width();o=r.prevImg.height();i=(s/o).toFixed(2);r.src.main.width.val(s);r.src.main.height.val(o)},100)}).attr("src",t)}},c=function(e){var t=parseInt(r.src.main.width.val())||0,n=parseInt(r.src.main.height.val())||0;if(r.prevImg){if(t&&n){if(e.target===r.src.main.width[0]){n=parseInt(t/i)}else{t=parseInt(n*i)}}else{t=s;n=o}r.src.main.height.val(n);r.src.main.width.val(t);r.prevImg.width(t).height(n);r.src.adv.style.val(r.prevImg.attr("style"))}};this.img=null;this.prevImg=null;this.preview=e('<div class="elrte-image-preview"/>').text("Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin");this.init=function(){this.labels={main:"Properies",link:"Link",adv:"Advanced",events:"Events",id:"ID","class":"Css class",style:"Css style",longdesc:"Detail description URL",href:"URL",target:"Open in",title:"Title"};this.src={main:{src:e('<input type="text" />').css("width","100%").change(l),title:e('<input type="text" />').css("width","100%"),alt:e('<input type="text" />').css("width","100%"),width:e('<input type="text" />').attr("size",5).css("text-align","right").change(c),height:e('<input type="text" />').attr("size",5).css("text-align","right").change(c),margin:e("<div />").elPaddingInput({type:"margin",change:function(){var e=r.src.main.margin.val();if(r.prevImg){if(e.css){r.prevImg.css("margin",e.css)}else{r.prevImg.css({"margin-left":e.left,"margin-top":e.top,"margin-right":e.right,"margin-bottom":e.bottom})}}}}),align:e("<select />").css("width","100%").append(e("<option />").val("").text(this.rte.i18n("Not set","dialogs"))).append(e("<option />").val("left").text(this.rte.i18n("Left"))).append(e("<option />").val("right").text(this.rte.i18n("Right"))).append(e("<option />").val("top").text(this.rte.i18n("Top"))).append(e("<option />").val("text-top").text(this.rte.i18n("Text top"))).append(e("<option />").val("middle").text(this.rte.i18n("middle"))).append(e("<option />").val("baseline").text(this.rte.i18n("Baseline"))).append(e("<option />").val("bottom").text(this.rte.i18n("Bottom"))).append(e("<option />").val("text-bottom").text(this.rte.i18n("Text bottom"))).change(function(){var t=e(this).val(),n={"float":"","vertical-align":""};if(r.prevImg){if(t=="left"||t=="right"){n["float"]=t;n["vertical-align"]=""}else if(t){n["float"]="";n["vertical-align"]=t}r.prevImg.css(n)}}),border:e("<div />").elBorderSelect({name:"border",change:function(){var e=r.src.main.border.val();if(r.prevImg){r.prevImg.css("border",e.width?e.width+" "+e.style+" "+e.color:"")}}})},adv:{},events:{}};e.each(["id","class","style","longdesc"],function(t,n){r.src.adv[n]=e('<input type="text" style="width:100%" />')});this.src.adv["class"].change(function(){if(r.prevImg){r.prevImg.attr("class",e(this).val())}});this.src.adv.style.change(function(){if(r.prevImg){r.prevImg.attr("style",e(this).val());f(r.prevImg)}});e.each(["onblur","onfocus","onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmouseout","onmouseleave","onkeydown","onkeypress","onkeyup"],function(){r.src.events[this]=e('<input type="text"  style="width:100%"/>')})};this.command=function(){!this.src&&this.init();var n,l={rtl:t.rtl,submit:function(e,t){e.stopPropagation();e.preventDefault();r.set();c.close()},close:function(){u&&t.selection.moveToBookmark(u)},dialog:{autoOpen:false,width:500,position:"top",title:t.i18n("Image"),resizable:true,open:function(){e.fn.resizable&&e(this).parents(".ui-dialog:first").resizable("option","alsoResize",".elrte-image-preview")}}},c=new elDialogForm(l),h=!!t.options.fmOpen,p=h?e('<div class="elrte-image-src-fm"><span class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-folder-open"/></span></div>').append(this.src.main.src.css("width","87%")):this.src.main.src;a();this.preview.children("img").remove();this.prevImg=null;n=t.selection.getEnd();this.img=n.nodeName=="IMG"&&!e(n).is(".elrte-protected")?e(n):e("<img/>");u=t.selection.getBookmark();if(h){p.children(".ui-state-default").click(function(){t.options.fmOpen(function(e){r.src.main.src.val(e).change()})}).hover(function(){e(this).toggleClass("ui-state-hover")})}c.tab("main",this.rte.i18n("Properies")).append([this.rte.i18n("Image URL"),p],"main",true).append([this.rte.i18n("Title"),this.src.main.title],"main",true).append([this.rte.i18n("Alt text"),this.src.main.alt],"main",true).append([this.rte.i18n("Size"),e("<span />").append(this.src.main.width).append(" x ").append(this.src.main.height).append(" px")],"main",true).append([this.rte.i18n("Alignment"),this.src.main.align],"main",true).append([this.rte.i18n("Margins"),this.src.main.margin],"main",true).append([this.rte.i18n("Border"),this.src.main.border],"main",true);c.append(e("<fieldset><legend>"+this.rte.i18n("Preview")+"</legend></fieldset>").append(this.preview),"main");e.each(this.src,function(n,i){if(n=="main"){return}c.tab(n,t.i18n(r.labels[n]));e.each(i,function(e,i){r.src[n][e].val(n=="events"?t.utils.trimEventCallback(r.img.attr(e)):r.img.attr(e)||"");c.append([t.i18n(r.labels[e]||e),r.src[n][e]],n,true)})});c.open();if(this.img.attr("src")){f(this.img);this.prevImg=this.img.clone().prependTo(this.preview);i=(this.img.width()/this.img.height()).toFixed(2);s=parseInt(this.img.width());o=parseInt(this.img.height())}};this.set=function(){var n=this.src.main.src.val(),i;this.rte.history.add();u&&t.selection.moveToBookmark(u);if(!n){i=t.dom.selfOrParentLink(this.img[0]);i&&i.remove();return this.img.remove()}!this.img[0].parentNode&&(this.img=e(this.rte.doc.createElement("img")));this.img.attr("src",n).attr("style",this.src.adv.style.val());e.each(this.src,function(t,n){e.each(n,function(t,n){var i=n.val(),s;switch(t){case"width":r.img.css("width",i);break;case"height":r.img.css("height",i);break;case"align":r.img.css(i=="left"||i=="right"?"float":"vertical-align",i);break;case"margin":if(i.css){r.img.css("margin",i.css)}else{r.img.css({"margin-left":i.left,"margin-top":i.top,"margin-right":i.right,"margin-bottom":i.bottom})}break;case"border":if(!i.width){i=""}else{i="border:"+i.css+";"+e.trim((r.img.attr("style")||"").replace(/border\-[^;]+;?/ig,""));t="style";r.img.attr("style",i);return}break;case"src":case"style":return;default:i?r.img.attr(t,i):r.img.removeAttr(t)}})});!this.img[0].parentNode&&t.selection.insertNode(this.img[0]);this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled");var t=this.rte.selection.getEnd(),n=e(t);if(t.nodeName=="IMG"&&!n.hasClass("elrte-protected")){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.indent=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.command=function(){function n(t){var n=/(IMG|HR|TABLE|EMBED|OBJECT)/.test(t.nodeName)?"margin-left":"padding-left";var i=r.rte.dom.attr(t,"style").indexOf(n)!=-1?parseInt(e(t).css(n))||0:0;e(t).css(n,i+40+"px")}this.rte.history.add();var t=this.rte.selection.selected({collapsed:true,blocks:true,wrap:"inline",tag:"p"});for(var i=0;i<t.length;i++){if(/^(TABLE|THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(t[i].nodeName)){e(t[i]).find("td,th").each(function(){n(this)})}else if(/^LI$/.test(t[i].nodeName)){var s=e(t[i]);e(this.rte.dom.create(t[i].parentNode.nodeName)).append(e(this.rte.dom.create("li")).html(s.html()||"")).appendTo(s.html("&nbsp;"))}else{n(t[i])}}this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.justifyleft=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.align=this.name=="justifyfull"?"justify":this.name.replace("justify","");this.command=function(){var t=this.rte.selection.selected({collapsed:true,blocks:true,tag:"div"}),n=t.length;n&&this.rte.history.add();while(n--){this.rte.dom.filter(t[n],"textNodes")&&e(t[n]).css("text-align",this.align)}this.rte.ui.update()};this.update=function(){var t=this.rte.selection.getNode(),n=t.nodeName=="BODY"?t:this.rte.dom.selfOrParent(t,"textNodes")||(t.parentNode&&t.parentNode.nodeName=="BODY"?t.parentNode:null);if(n){this.domElem.removeClass("disabled").toggleClass("active",e(n).css("text-align")==this.align)}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.justifycenter=elRTE.prototype.ui.prototype.buttons.justifyleft;elRTE.prototype.ui.prototype.buttons.justifyright=elRTE.prototype.ui.prototype.buttons.justifyleft;elRTE.prototype.ui.prototype.buttons.justifyfull=elRTE.prototype.ui.prototype.buttons.justifyleft})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.link=function(t,n){function i(){r.labels={id:"ID","class":"Css class",style:"Css style",dir:"Script direction",lang:"Language",charset:"Charset",type:"Target MIME type",rel:"Relationship page to target (rel)",rev:"Relationship target to page (rev)",tabindex:"Tab index",accesskey:"Access key"};r.src={main:{href:e('<input type="text" />'),title:e('<input type="text" />'),anchor:e("<select />").attr("name","anchor"),target:e("<select />").append(e("<option />").text(r.rte.i18n("In this window")).val("")).append(e("<option />").text(r.rte.i18n("In new window (_blank)")).val("_blank"))},popup:{use:e('<input type="checkbox" />'),url:e('<input type="text" />').val("http://"),name:e('<input type="text" />'),width:e('<input type="text" />').attr({size:6,title:r.rte.i18n("Width")}).css("text-align","right"),height:e('<input type="text" />').attr({size:6,title:r.rte.i18n("Height")}).css("text-align","right"),left:e('<input type="text" />').attr({size:6,title:r.rte.i18n("Left")}).css("text-align","right"),top:e('<input type="text" />').attr({size:6,title:r.rte.i18n("Top")}).css("text-align","right"),location:e('<input type="checkbox" />'),menubar:e('<input type="checkbox" />'),toolbar:e('<input type="checkbox" />'),scrollbars:e('<input type="checkbox" />'),status:e('<input type="checkbox" />'),resizable:e('<input type="checkbox" />'),dependent:e('<input type="checkbox" />'),retfalse:e('<input type="checkbox" />').attr("checked",true)},adv:{id:e('<input type="text" />'),"class":e('<input type="text" />'),style:e('<input type="text" />'),dir:e("<select />").append(e("<option />").text(r.rte.i18n("Not set")).val("")).append(e("<option />").text(r.rte.i18n("Left to right")).val("ltr")).append(e("<option />").text(r.rte.i18n("Right to left")).val("rtl")),lang:e('<input type="text" />'),charset:e('<input type="text" />'),type:e('<input type="text" />'),rel:e('<input type="text" />'),rev:e('<input type="text" />'),tabindex:e('<input type="text" />'),accesskey:e('<input type="text" />')},events:{}};e.each(["onblur","onfocus","onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmouseout","onmouseleave","onkeydown","onkeypress","onkeyup"],function(){r.src.events[this]=e('<input type="text" />')});e.each(r.src,function(){for(var e in this){var t=this[e].attr("type");if(!t||t=="text"&&!this[e].attr("size")){this[e].css("width","100%")}}})}this.constructor.prototype.constructor.call(this,t,n);var r=this;this.img=false;this.bm;this.command=function(){function p(e){return e.nodeName=="A"&&e.href}var t=this.rte.selection.getNode(),n,s,o,u,a,f,l,c,h;!this.src&&i();this.bm=this.rte.selection.getBookmark();this.link=this.rte.dom.selfOrParentLink(t);if(!this.link){n=e.browser.msie?this.rte.selection.selected():this.rte.selection.selected({wrap:false});if(n.length){for(s=0;s<n.length;s++){if(p(n[s])){this.link=n[s];break}}if(!this.link){this.link=this.rte.dom.parent(n[0],p)||this.rte.dom.parent(n[n.length-1],p)}}}this.link=this.link?e(this.link):e(this.rte.doc.createElement("a"));this.img=t.nodeName=="IMG"?t:null;this.updatePopup();this.src.main.anchor.empty();e('a[href!=""][name]',this.rte.doc).each(function(){var t=e(this).attr("name");r.src.main.anchor.append(e("<option />").val(t).text(t))});if(this.src.main.anchor.children().length){this.src.main.anchor.prepend(e("<option />").val("").text(this.rte.i18n("Select bookmark"))).change(function(){var t=e(this).val();if(t){r.src.main.href.val("#"+t)}})}u={rtl:this.rte.rtl,submit:function(e,t){e.stopPropagation();e.preventDefault();r.set();t.close()},tabs:{show:function(e,t){if(t.index==3){r.updateOnclick()}}},close:function(){r.rte.browser.msie&&r.rte.selection.restoreIERange()},dialog:{width:"auto",width:430,title:this.rte.i18n("Link")}};d=new elDialogForm(u);a=e("<div />").append(e("<label />").append(this.src.popup.location).append(this.rte.i18n("Location bar"))).append(e("<label />").append(this.src.popup.menubar).append(this.rte.i18n("Menu bar"))).append(e("<label />").append(this.src.popup.toolbar).append(this.rte.i18n("Toolbar"))).append(e("<label />").append(this.src.popup.scrollbars).append(this.rte.i18n("Scrollbars")));f=e("<div />").append(e("<label />").append(this.src.popup.status).append(this.rte.i18n("Status bar"))).append(e("<label />").append(this.src.popup.resizable).append(this.rte.i18n("Resizable"))).append(e("<label />").append(this.src.popup.dependent).append(this.rte.i18n("Depedent"))).append(e("<label />").append(this.src.popup.retfalse).append(this.rte.i18n("Add return false")));d.tab("main",this.rte.i18n("Properies")).tab("popup",this.rte.i18n("Popup")).tab("adv",this.rte.i18n("Advanced")).tab("events",this.rte.i18n("Events")).append(e("<label />").append(this.src.popup.use).append(this.rte.i18n("Open link in popup window")),"popup").separator("popup").append([this.rte.i18n("URL"),this.src.popup.url],"popup",true).append([this.rte.i18n("Window name"),this.src.popup.name],"popup",true).append([this.rte.i18n("Window size"),e("<span />").append(this.src.popup.width).append(" x ").append(this.src.popup.height).append(" px")],"popup",true).append([this.rte.i18n("Window position"),e("<span />").append(this.src.popup.left).append(" x ").append(this.src.popup.top).append(" px")],"popup",true).separator("popup").append([a,f],"popup",true);l=this.link.get(0);c=this.rte.dom.attr(l,"href");this.src.main.href.val(c).change(function(){e(this).val(r.rte.utils.absoluteURL(e(this).val()))});if(this.rte.options.fmAllow&&this.rte.options.fmOpen){var h=e("<span />").append(this.src.main.href.css("width","87%")).append(e("<span />").addClass("ui-state-default ui-corner-all").css({"float":"right","margin-right":"3px"}).attr("title",r.rte.i18n("Open file manger")).append(e("<span />").addClass("ui-icon ui-icon-folder-open")).click(function(){r.rte.options.fmOpen(function(e){r.src.main.href.val(e).change()})}).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}));d.append([this.rte.i18n("Link URL"),h],"main",true)}else{d.append([this.rte.i18n("Link URL"),this.src.main.href],"main",true)}this.src.main.href.change();d.append([this.rte.i18n("Title"),this.src.main.title.val(this.rte.dom.attr(l,"title"))],"main",true);if(this.src.main.anchor.children().length){d.append([this.rte.i18n("Bookmark"),this.src.main.anchor.val(c)],"main",true)}if(!(this.rte.options.doctype.match(/xhtml/)&&this.rte.options.doctype.match(/strict/))){d.append([this.rte.i18n("Target"),this.src.main.target.val(this.link.attr("target")||"")],"main",true)}for(var t in this.src.adv){this.src.adv[t].val(this.rte.dom.attr(l,t));d.append([this.rte.i18n(this.labels[t]?this.labels[t]:t),this.src.adv[t]],"adv",true)}for(var t in this.src.events){var o=this.rte.utils.trimEventCallback(this.rte.dom.attr(l,t));this.src.events[t].val(o);d.append([this.rte.i18n(this.labels[t]?this.labels[t]:t),this.src.events[t]],"events",true)}this.src.popup.use.change(function(){var t=e(this).attr("checked");e.each(r.src.popup,function(){if(e(this).attr("name")!="use"){if(t){e(this).removeAttr("disabled")}else{e(this).attr("disabled",true)}}})});this.src.popup.use.change();d.open()};this.update=function(){var e=this.rte.selection.getNode();if(this.rte.dom.selfOrParentLink(e)){this.domElem.removeClass("disabled").addClass("active")}else if(this.rte.dom.selectionHas(function(e){return e.nodeName=="A"&&e.href})){this.domElem.removeClass("disabled").addClass("active")}else if(!this.rte.selection.collapsed()||e.nodeName=="IMG"){this.domElem.removeClass("disabled active")}else{this.domElem.addClass("disabled").removeClass("active")}};this.updatePopup=function(){var t=""+this.link.attr("onclick");if(t.length>0&&(m=t.match(/window.open\('([^']+)',\s*'([^']*)',\s*'([^']*)'\s*.*\);\s*(return\s+false)?/))){this.src.popup.use.attr("checked","on");this.src.popup.url.val(m[1]);this.src.popup.name.val(m[2]);if(/location=yes/.test(m[3])){this.src.popup.location.attr("checked",true)}if(/menubar=yes/.test(m[3])){this.src.popup.menubar.attr("checked",true)}if(/toolbar=yes/.test(m[3])){this.src.popup.toolbar.attr("checked",true)}if(/scrollbars=yes/.test(m[3])){this.src.popup.scrollbars.attr("checked",true)}if(/status=yes/.test(m[3])){this.src.popup.status.attr("checked",true)}if(/resizable=yes/.test(m[3])){this.src.popup.resizable.attr("checked",true)}if(/dependent=yes/.test(m[3])){this.src.popup.dependent.attr("checked",true)}if(_m=m[3].match(/width=([^,]+)/)){this.src.popup.width.val(_m[1])}if(_m=m[3].match(/height=([^,]+)/)){this.src.popup.height.val(_m[1])}if(_m=m[3].match(/left=([^,]+)/)){this.src.popup.left.val(_m[1])}if(_m=m[3].match(/top=([^,]+)/)){this.src.popup.top.val(_m[1])}if(m[4]){this.src.popup.retfalse.attr("checked",true)}}else{e.each(this.src.popup,function(){var t=e(this);if(t.attr("type")=="text"){t.val(t.attr("name")=="url"?"http://":"")}else{if(t.attr("name")=="retfalse"){this.attr("checked",true)}else{t.removeAttr("checked")}}})}};this.updateOnclick=function(){var t=this.src.popup.url.val();if(this.src.popup.use.attr("checked")&&t){var n="";if(this.src.popup.location.attr("checked")){n+="location=yes,"}if(this.src.popup.menubar.attr("checked")){n+="menubar=yes,"}if(this.src.popup.toolbar.attr("checked")){n+="toolbar=yes,"}if(this.src.popup.scrollbars.attr("checked")){n+="scrollbars=yes,"}if(this.src.popup.status.attr("checked")){n+="status=yes,"}if(this.src.popup.resizable.attr("checked")){n+="resizable=yes,"}if(this.src.popup.dependent.attr("checked")){n+="dependent=yes,"}if(this.src.popup.width.val()){n+="width="+this.src.popup.width.val()+","}if(this.src.popup.height.val()){n+="height="+this.src.popup.height.val()+","}if(this.src.popup.left.val()){n+="left="+this.src.popup.left.val()+","}if(this.src.popup.top.val()){n+="top="+this.src.popup.top.val()+","}if(n.length>0){n=n.substring(0,n.length-1)}var r=this.src.popup.retfalse.attr("checked")?"return false;":"";var i="window.open('"+t+"', '"+e.trim(this.src.popup.name.val())+"', '"+n+"'); "+r;this.src.events.onclick.val(i);if(!this.src.main.href.val()){this.src.main.href.val("#")}}else{var s=this.src.events.onclick.val();s=s.replace(/window\.open\([^\)]+\)\s*;?\s*return\s*false\s*;?/i,"");this.src.events.onclick.val(s)}};this.set=function(){var t,n;this.updateOnclick();this.rte.selection.moveToBookmark(this.bm);this.rte.history.add();t=this.rte.utils.absoluteURL(this.src.main.href.val());if(!t){var r=this.rte.selection.getBookmark();this.rte.dom.unwrap(this.link[0]);this.rte.selection.moveToBookmark(r)}else{if(this.img&&this.img.parentNode){this.link=e(this.rte.dom.create("a")).attr("href",t);this.rte.dom.wrap(this.img,this.link[0])}else if(!this.link[0].parentNode){n="#--el-editor---"+Math.random();this.rte.doc.execCommand("createLink",false,n);this.link=e('a[href="'+n+'"]',this.rte.doc);this.link.each(function(){var t=e(this);if(!e.trim(t.html())&&!e.trim(t.text())){t.replaceWith(t.text())}})}this.src.main.href.val(t);for(var i in this.src){if(i!="popup"){for(var s in this.src[i]){if(s!="anchors"){var o=e.trim(this.src[i][s].val());if(o){this.link.attr(s,o)}else{this.link.removeAttr(s)}}}}}this.img&&this.rte.selection.select(this.img)}this.rte.ui.update(true)}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.nbsp=function(e,t){this.constructor.prototype.constructor.call(this,e,t);this.command=function(){this.rte.history.add();this.rte.selection.insertHtml("&nbsp;",true);this.rte.window.focus();this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.outdent=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.command=function(){var t=this.find();if(t.node){this.rte.history.add();e(t.node).css(t.type,(t.val>40?t.val-40:0)+"px");this.rte.ui.update()}};this.find=function(t){function n(t){var n={type:"",val:0};var i;if(i=r.rte.dom.attr(t,"style")){n.type=i.indexOf("padding-left")!=-1?"padding-left":i.indexOf("margin-left")!=-1?"margin-left":"";n.val=n.type?parseInt(e(t).css(n.type))||0:0}return n}var t=this.rte.selection.getNode();var i=n(t);if(i.val){i.node=t}else{e.each(this.rte.dom.parents(t,"*"),function(){i=n(this);if(i.val){i.node=this;return i}})}return i};this.update=function(){var e=this.find();if(e.node){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.pagebreak=function(t,n){this.constructor.prototype.constructor.call(this,t,n);e(this.rte.doc.body).bind("mousedown",function(t){if(e(t.target).hasClass("elrte-pagebreak")){t.preventDefault()}});this.command=function(){this.rte.selection.insertHtml('<img src="'+this.rte.filter.url+'pixel.gif" class="elrte-protected elrte-pagebreak"/>',false)};this.update=function(){this.domElem.removeClass("disabled")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.pasteformattext=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.iframe=e(document.createElement("iframe")).addClass("el-rte-paste-input");this.doc=null;var r=this;this.command=function(){this.rte.selection.saveIERange();var e=this,t={submit:function(t,n){t.stopPropagation();t.preventDefault();e.paste();n.close()},dialog:{width:500,title:this.rte.i18n("Paste formatted text")}},n=new elDialogForm(t);n.append(this.iframe).open();this.doc=this.iframe.get(0).contentWindow.document;html=this.rte.options.doctype+'<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';html+="</head><body> <br /> </body></html>";this.doc.open();this.doc.write(html);this.doc.close();if(!this.rte.browser.msie){try{this.doc.designMode="on"}catch(r){}}else{this.doc.body.contentEditable=true}setTimeout(function(){e.iframe[0].contentWindow.focus()},50)};this.paste=function(){e(this.doc.body).find("[class]").removeAttr("class");var t=e.trim(e(this.doc.body).html());if(t){this.rte.history.add();this.rte.selection.restoreIERange();this.rte.selection.insertHtml(this.rte.filter.wysiwyg2wysiwyg(this.rte.filter.proccess("paste",t)));this.rte.ui.update(true)}};this.update=function(){this.domElem.removeClass("disabled")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.pastetext=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.input=e("<textarea />").addClass("el-rte-paste-input");var r=this;this.command=function(){this.rte.browser.msie&&this.rte.selection.saveIERange();var e={submit:function(e,t){e.stopPropagation();e.preventDefault();r.paste();t.close()},dialog:{width:500,title:this.rte.i18n("Paste only text")}};var t=new elDialogForm(e);t.append(this.input).open()};this.paste=function(){var t=e.trim(this.input.val());if(t){this.rte.history.add();this.rte.browser.msie&&this.rte.selection.restoreIERange();this.rte.selection.insertText(t.replace(/\r?\n/g,"<br />"),true);this.rte.ui.update(true)}this.input.val("")};this.update=function(){this.domElem.removeClass("disabled")}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.save=function(e,t){this.constructor.prototype.constructor.call(this,e,t);this.active=true;this.command=function(){this.rte.save()};this.update=function(){}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.smiley=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.img=null;this.url=this.rte.filter.url+"smileys/";this.smileys={smile:"smile.png",happy:"happy.png",tongue:"tongue.png",surprised:"surprised.png",waii:"waii.png",wink:"wink.png",evilgrin:"evilgrin.png",grin:"grin.png",unhappy:"unhappy.png"};this.width=120;this.command=function(){var t=this,n=this.url,r,i,s;this.rte.browser.msie&&this.rte.selection.saveIERange();i={dialog:{height:120,width:this.width,title:this.rte.i18n("Smiley"),buttons:{}}};r=new elDialogForm(i);e.each(this.smileys,function(i,s){r.append(e('<img src="'+n+s+'" title="'+i+'" id="'+i+'" class="el-rte-smiley"/>').click(function(){t.set(this.id,r)}))});r.open()};this.update=function(){this.domElem.removeClass("disabled");this.domElem.removeClass("active")};this.set=function(t,n){this.rte.browser.msie&&this.rte.selection.restoreIERange();if(this.smileys[t]){this.img=e(this.rte.doc.createElement("img"));this.img.attr({src:this.url+this.smileys[t],title:t,alt:t});this.rte.selection.insertNode(this.img.get(0));this.rte.ui.update()}n.close()}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.stopfloat=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.find=function(){if(this.rte.selection.collapsed()){var t=this.rte.dom.selfOrParent(this.rte.selection.getEnd(),/^DIV$/);if(t&&(this.rte.dom.attr(t,"clear")||e(t).css("clear")!="none")){return t}}};this.command=function(){var t;if(t=this.find()){var t=e(t);this.rte.history.add();if(!t.children().length&&!e.trim(t.text()).length){t.remove()}else{t.removeAttr("clear").css("clear","")}}else{this.rte.history.add();this.rte.selection.insertNode(e(this.rte.dom.create("div")).css("clear","both").get(0),true)}this.rte.ui.update(true)};this.update=function(){this.domElem.removeClass("disabled");if(this.find()){this.domElem.addClass("active")}else{this.domElem.removeClass("active")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.table=function(t,n){function i(){r.labels={main:"Properies",adv:"Advanced",events:"Events",id:"ID","class":"Css class",style:"Css style",dir:"Script direction",summary:"Summary",lang:"Language",href:"URL"};r.src={main:{caption:e('<input type="text" />'),rows:e('<input type="text" />').attr("size",5).val(2),cols:e('<input type="text" />').attr("size",5).val(2),width:e('<input type="text" />').attr("size",5),wunit:e("<select />").append(e("<option />").val("%").text("%")).append(e("<option />").val("px").text("px")),height:e('<input type="text" />').attr("size",5),hunit:e("<select />").append(e("<option />").val("%").text("%")).append(e("<option />").val("px").text("px")),align:e("<select />").append(e("<option />").val("").text(r.rte.i18n("Not set"))).append(e("<option />").val("left").text(r.rte.i18n("Left"))).append(e("<option />").val("center").text(r.rte.i18n("Center"))).append(e("<option />").val("right").text(r.rte.i18n("Right"))),spacing:e('<input type="text" />').attr("size",5),padding:e('<input type="text" />').attr("size",5),border:e("<div />"),rules:e("<select />").append(e("<option />").val("none").text(r.rte.i18n("No"))).append(e("<option />").val("all").text(r.rte.i18n("Cells"))).append(e("<option />").val("groups").text(r.rte.i18n("Groups"))).append(e("<option />").val("rows").text(r.rte.i18n("Rows"))).append(e("<option />").val("cols").text(r.rte.i18n("Columns"))),margin:e("<div />"),bg:e("<div />"),bgimg:e('<input type="text" />').css("width","90%")},adv:{id:e('<input type="text" />'),summary:e('<input type="text" />'),"class":e('<input type="text" />'),style:e('<input type="text" />'),dir:e("<select />").append(e("<option />").text(r.rte.i18n("Not set")).val("")).append(e("<option />").text(r.rte.i18n("Left to right")).val("ltr")).append(e("<option />").text(r.rte.i18n("Right to left")).val("rtl")),lang:e('<input type="text" />')},events:{}};e.each(r.src,function(){for(var e in this){this[e].attr("name",e);var t=this[e].get(0).nodeName;if(t=="INPUT"&&e!="bgimg"){this[e].css(this[e].attr("size")?{"text-align":"right"}:{width:"100%"})}else if(t=="SELECT"&&e!="wunit"&&e!="hunit"){this[e].css("width","100%")}}});e.each(["onblur","onfocus","onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmouseout","onmouseleave","onkeydown","onkeypress","onkeyup"],function(){r.src.events[this]=e('<input type="text" />').css("width","100%")});r.src.main.align.change(function(){var t=e(this).val();if(t=="center"){r.src.main.margin.val({left:"auto",right:"auto"})}else{var n=r.src.main.margin.val();if(n.left=="auto"&&n.right=="auto"){r.src.main.margin.val({left:"",right:""})}}});r.src.main.bgimg.change(function(){var t=e(this);t.val(r.rte.utils.absoluteURL(t.val()))})}this.constructor.prototype.constructor.call(this,t,n);var r=this;this.src=null;this.labels=null;this.command=function(){var t=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TABLE$/);if(this.name=="table"){this.table=e(this.rte.doc.createElement("table"))}else{this.table=t?e(t):e(this.rte.doc.createElement("table"))}!this.src&&i();this.src.main.border.elBorderSelect({styleHeight:117});this.src.main.bg.elColorPicker({palettePosition:"outer","class":"el-colorpicker ui-icon ui-icon-pencil"});this.src.main.margin.elPaddingInput({type:"margin",value:this.table});if(this.table.parents().length){this.src.main.rows.val("").attr("disabled",true);this.src.main.cols.val("").attr("disabled",true)}else{this.src.main.rows.val(2).removeAttr("disabled");this.src.main.cols.val(2).removeAttr("disabled")}var n=this.table.css("width")||this.table.attr("width");this.src.main.width.val(parseInt(n)||"");this.src.main.wunit.val(n.indexOf("px")!=-1?"px":"%");var s=this.table.css("height")||this.table.attr("height");this.src.main.height.val(parseInt(s)||"");this.src.main.hunit.val(s&&s.indexOf("px")!=-1?"px":"%");var o=this.table.css("float");this.src.main.align.val("");if(o=="left"||o=="right"){this.src.main.align.val(o)}else{var u=this.table.css("margin-left");var a=this.table.css("margin-right");if(u=="auto"&&a=="auto"){this.src.main.align.val("center")}}this.src.main.border.val(this.table);this.src.main.rules.val(this.rte.dom.attr(this.table.get(0),"rules"));this.src.main.bg.val(this.table.css("background-color"));var f=(this.table.css("background-image")||"").replace(/url\(([^\)]+)\)/i,"$1");this.src.main.bgimg.val(f!="none"?f:"");var l={rtl:this.rte.rtl,submit:function(e,t){e.stopPropagation();e.preventDefault();r.set();t.close()},dialog:{width:530,title:this.rte.i18n("Table")}};var c=new elDialogForm(l);for(var h in this.src){c.tab(h,this.rte.i18n(this.labels[h]));if(h=="main"){var p=e("<table />").append(e("<tr />").append("<td>"+this.rte.i18n("Rows")+"</td>").append(e("<td />").append(this.src.main.rows))).append(e("<tr />").append("<td>"+this.rte.i18n("Columns")+"</td>").append(e("<td />").append(this.src.main.cols)));var d=e("<table />").append(e("<tr />").append("<td>"+this.rte.i18n("Width")+"</td>").append(e("<td />").append(this.src.main.width).append(this.src.main.wunit))).append(e("<tr />").append("<td>"+this.rte.i18n("Height")+"</td>").append(e("<td />").append(this.src.main.height).append(this.src.main.hunit)));var v=e("<table />").append(e("<tr />").append("<td>"+this.rte.i18n("Spacing")+"</td>").append(e("<td />").append(this.src.main.spacing.val(this.table.attr("cellspacing")||"")))).append(e("<tr />").append("<td>"+this.rte.i18n("Padding")+"</td>").append(e("<td />").append(this.src.main.padding.val(this.table.attr("cellpadding")||""))));c.append([this.rte.i18n("Caption"),this.src.main.caption.val(this.table.find("caption").eq(0).text()||"")],"main",true).separator("main").append([p,d,v],"main",true).separator("main").append([this.rte.i18n("Border"),this.src.main.border],"main",true).append([this.rte.i18n("Inner borders"),this.src.main.rules],"main",true).append([this.rte.i18n("Alignment"),this.src.main.align],"main",true).append([this.rte.i18n("Margins"),this.src.main.margin],"main",true).append([this.rte.i18n("Background"),e("<span />").append(e("<span />").css({"float":"left","margin-right":"3px"}).append(this.src.main.bg)).append(this.src.main.bgimg)],"main",true)}else{for(var m in this.src[h]){var g=this.rte.dom.attr(this.table,m);if(h=="events"){g=this.rte.utils.trimEventCallback(g)}c.append([this.rte.i18n(this.labels[m]?this.labels[m]:m),this.src[h][m].val(g)],h,true)}}}c.open()};this.set=function(){if(!this.table.parents().length){var t=parseInt(this.src.main.rows.val())||0;var n=parseInt(this.src.main.cols.val())||0;if(t<=0||n<=0){return}this.rte.history.add();var r=e(this.rte.doc.createElement("tbody")).appendTo(this.table);for(var i=0;i<t;i++){var s="<tr>";for(var o=0;o<n;o++){s+="<td>&nbsp;</td>"}r.append(s+"</tr>")}}else{this.table.removeAttr("width").removeAttr("height").removeAttr("border").removeAttr("align").removeAttr("bordercolor").removeAttr("bgcolor").removeAttr("cellspacing").removeAttr("cellpadding").removeAttr("frame").removeAttr("rules").removeAttr("style")}var u=e.trim(this.src.main.caption.val());if(u){if(!this.table.children("caption").length){this.table.prepend("<caption />")}this.table.children("caption").text(u)}else{this.table.children("caption").remove()}for(var a in this.src){if(a!="main"){for(var f in this.src[a]){var l=e.trim(this.src[a][f].val());if(l){this.table.attr(f,l)}else{this.table.removeAttr(f)}}}}var c,h,p;if((c=parseInt(this.src.main.spacing.val()))&&c>=0){this.table.attr("cellspacing",c)}if((h=parseInt(this.src.main.padding.val()))&&h>=0){this.table.attr("cellpadding",h)}if(p=this.src.main.rules.val()){this.table.attr("rules",p)}var d=parseInt(this.src.main.width.val())||"",v=parseInt(this.src.main.height.val())||"",i=e.trim(this.src.main.bgimg.val()),r=this.src.main.border.val(),m=this.src.main.margin.val(),g=this.src.main.align.val();this.table.css({width:d?d+this.src.main.wunit.val():"",height:v?v+this.src.main.hunit.val():"",border:e.trim(r.width+" "+r.style+" "+r.color),"background-color":this.src.main.bg.val(),"background-image":i?"url("+i+")":""});if(m.css){this.table.css("margin",m.css)}else{this.table.css({"margin-top":m.top,"margin-right":m.right,"margin-bottom":m.bottom,"margin-left":m.left})}if((g=="left"||g=="right")&&this.table.css("margin-left")!="auto"&&this.table.css("margin-right")!="auto"){this.table.css("float",g)}if(!this.table.attr("style")){this.table.removeAttr("style")}if(!this.table.parents().length){this.rte.selection.insertNode(this.table.get(0),true)}this.rte.ui.update()};this.update=function(){this.domElem.removeClass("disabled");if(this.name=="tableprops"&&!this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TABLE$/)){this.domElem.addClass("disabled").removeClass("active")}}};elRTE.prototype.ui.prototype.buttons.tableprops=elRTE.prototype.ui.prototype.buttons.table})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.tablerm=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.command=function(){var t=this.rte.dom.parent(this.rte.selection.getNode(),/^TABLE$/);if(t){this.rte.history.add();e(t).remove()}this.rte.ui.update(true)};this.update=function(){if(this.rte.dom.parent(this.rte.selection.getNode(),/^TABLE$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.tbcellprops=function(t,n){function i(){r.labels={main:"Properies",adv:"Advanced",events:"Events",id:"ID","class":"Css class",style:"Css style",dir:"Script direction",lang:"Language"};r.src={main:{type:e("<select />").css("width","100%").append(e("<option />").val("td").text(r.rte.i18n("Data"))).append(e("<option />").val("th").text(r.rte.i18n("Header"))),width:e('<input type="text" />').attr("size",4),wunit:e("<select />").append(e("<option />").val("%").text("%")).append(e("<option />").val("px").text("px")),height:e('<input type="text" />').attr("size",4),hunit:e("<select />").append(e("<option />").val("%").text("%")).append(e("<option />").val("px").text("px")),align:e("<select />").css("width","100%").append(e("<option />").val("").text(r.rte.i18n("Not set"))).append(e("<option />").val("left").text(r.rte.i18n("Left"))).append(e("<option />").val("center").text(r.rte.i18n("Center"))).append(e("<option />").val("right").text(r.rte.i18n("Right"))).append(e("<option />").val("justify").text(r.rte.i18n("Justify"))),border:e("<div />"),padding:e("<div />"),bg:e("<div />"),bgimg:e('<input type="text" />').css("width","90%"),apply:e("<select />").css("width","100%").append(e("<option />").val("").text(r.rte.i18n("Current cell"))).append(e("<option />").val("row").text(r.rte.i18n("All cells in row"))).append(e("<option />").val("column").text(r.rte.i18n("All cells in column"))).append(e("<option />").val("table").text(r.rte.i18n("All cells in table")))},adv:{id:e('<input type="text" />'),"class":e('<input type="text" />'),style:e('<input type="text" />'),dir:e("<select />").css("width","100%").append(e("<option />").text(r.rte.i18n("Not set")).val("")).append(e("<option />").text(r.rte.i18n("Left to right")).val("ltr")).append(e("<option />").text(r.rte.i18n("Right to left")).val("rtl")),lang:e('<input type="text" />')},events:{}};e.each(r.src,function(){for(var e in this){this[e].attr("name",e);if(this[e].attr("type")=="text"&&!this[e].attr("size")&&e!="bgimg"){this[e].css("width","100%")}}});e.each(["onblur","onfocus","onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmouseout","onmouseleave","onkeydown","onkeypress","onkeyup"],function(){r.src.events[this]=e('<input type="text" />').css("width","100%")})}this.constructor.prototype.constructor.call(this,t,n);var r=this;this.src=null;this.labels=null;this.command=function(){!this.src&&i();this.cell=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/);if(!this.cell){return}this.src.main.type.val(this.cell.nodeName.toLowerCase());this.cell=e(this.cell);this.src.main.border.elBorderSelect({styleHeight:117,value:this.cell});this.src.main.bg.elColorPicker({palettePosition:"outer","class":"el-colorpicker ui-icon ui-icon-pencil"});this.src.main.padding.elPaddingInput({value:this.cell});var t=this.cell.css("width")||this.cell.attr("width");this.src.main.width.val(parseInt(t)||"");this.src.main.wunit.val(t.indexOf("px")!=-1?"px":"%");var n=this.cell.css("height")||this.cell.attr("height");this.src.main.height.val(parseInt(n)||"");this.src.main.hunit.val(n.indexOf("px")!=-1?"px":"%");this.src.main.align.val(this.cell.attr("align")||this.cell.css("text-align"));this.src.main.bg.val(this.cell.css("background-color"));var s=this.cell.css("background-image");this.src.main.bgimg.val(s&&s!="none"?s.replace(/url\(([^\)]+)\)/i,"$1"):"");this.src.main.apply.val("");var o={rtl:this.rte.rtl,submit:function(e,t){e.stopPropagation();e.preventDefault();r.set();t.close()},dialog:{width:520,title:this.rte.i18n("Table cell properties")}};var u=new elDialogForm(o);for(var a in this.src){u.tab(a,this.rte.i18n(this.labels[a]));if(a=="main"){u.append([this.rte.i18n("Width"),e("<span />").append(this.src.main.width).append(this.src.main.wunit)],"main",true).append([this.rte.i18n("Height"),e("<span />").append(this.src.main.height).append(this.src.main.hunit)],"main",true).append([this.rte.i18n("Table cell type"),this.src.main.type],"main",true).append([this.rte.i18n("Border"),this.src.main.border],"main",true).append([this.rte.i18n("Alignment"),this.src.main.align],"main",true).append([this.rte.i18n("Paddings"),this.src.main.padding],"main",true).append([this.rte.i18n("Background"),e("<span />").append(e("<span />").css({"float":"left","margin-right":"3px"}).append(this.src.main.bg)).append(this.src.main.bgimg)],"main",true).append([this.rte.i18n("Apply to"),this.src.main.apply],"main",true)}else{for(var f in this.src[a]){var l=this.cell.attr(f)||"";if(a=="events"){l=this.rte.utils.trimEventCallback(l)}u.append([this.rte.i18n(this.labels[f]?this.labels[f]:f),this.src[a][f].val(l)],a,true)}}}u.open()};this.set=function(){var t=this.cell,n=this.src.main.apply.val();switch(this.src.main.apply.val()){case"row":t=this.cell.parent("tr").children("td,th");break;case"column":t=e(this.rte.dom.tableColumn(this.cell.get(0)));break;case"table":t=this.cell.parents("table").find("td,th");break}for(var i in this.src){if(i!="main"){for(var s in this.src[i]){var o=e.trim(this.src[i][s].val());if(o){t.attr(s,o)}else{t.removeAttr(s)}}}}t.removeAttr("width").removeAttr("height").removeAttr("border").removeAttr("align").removeAttr("bordercolor").removeAttr("bgcolor");var u=this.src.main.type.val();var a=parseInt(this.src.main.width.val())||"";var f=parseInt(this.src.main.height.val())||"";var l=e.trim(this.src.main.bgimg.val());var c=this.src.main.border.val();var h={width:a?a+this.src.main.wunit.val():"",height:f?f+this.src.main.hunit.val():"","background-color":this.src.main.bg.val(),"background-image":l?"url("+l+")":"",border:e.trim(c.width+" "+c.style+" "+c.color),"text-align":this.src.main.align.val()||""};var p=this.src.main.padding.val();if(p.css){h.padding=p.css}else{h["padding-top"]=p.top;h["padding-right"]=p.right;h["padding-bottom"]=p.bottom;h["padding-left"]=p.left}t=t.get();e.each(t,function(){var t=this.nodeName.toLowerCase();var n=e(this);if(t!=u){var i={};for(var s in r.src.adv){var o=n.attr(s);if(o){i[s]=o.toString()}}for(var s in r.src.events){var o=n.attr(s);if(o){i[s]=o.toString()}}var a=n.attr("colspan")||1;var f=n.attr("rowspan")||1;if(a>1){i.colspan=a}if(f>1){i.rowspan=f}n.replaceWith(e("<"+u+" />").html(n.html()).attr(i).css(h))}else{n.css(h)}});this.rte.ui.update()};this.update=function(){if(this.rte.dom.parent(this.rte.selection.getNode(),/^TABLE$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.tbcellsmerge=function(t,n){function i(){var t=r.rte.dom.selfOrParent(r.rte.selection.getStart(),/^(TD|TH)$/);var n=r.rte.dom.selfOrParent(r.rte.selection.getEnd(),/^(TD|TH)$/);if(t&&n&&t!=n&&e(t).parents("table").get(0)==e(n).parents("table").get(0)){return[t,n]}return null}this.constructor.prototype.constructor.call(this,t,n);var r=this;this.command=function(){var t=i();if(t){var n=this.rte.dom.indexOf(e(t[0]).parent("tr").get(0));var r=this.rte.dom.indexOf(e(t[1]).parent("tr").get(0));var s=Math.min(n,r);var o=Math.max(n,r)-s+1;var u=this.rte.dom.tableColumn(t[0],true,true);var a=this.rte.dom.tableColumn(t[1],true);var f=e.inArray(t[0],u.column);var l=e.inArray(t[1],a.column);var c=u.info.offset[f]<a.info.offset[l]?u:a;var h=u.info.offset[f]>=a.info.offset[l]?u:a;var p=0;var d=null;var v="";this.rte.history.add();var m=e(e(t[0]).parents("table").eq(0).find("tr").get().slice(s,s+o)).each(function(t){var n=v.length;var r=false;e(this).children("td,th").each(function(){var n=e(this);var i=e.inArray(this,c.column);var s=e.inArray(this,h.column);if(i!=-1||s!=-1){r=i!=-1&&s==-1;var o=parseInt(n.attr("colspan")||1);if(t==0){p+=o}if(i!=-1&&t>0){var u=c.info.delta[i];if(u>0){if(n.css("text-align")=="left"){var a=n.clone(true);n.html("&nbsp;")}else{var a=n.clone().html("&nbsp;")}a.removeAttr("colspan").removeAttr("id").insertBefore(this);if(u>1){a.attr("colspan",u)}}}if(s!=-1){var u=h.info.delta[s];if(o-u>1){var f=o-u-1;if(n.css("text-align")=="right"){var a=n.clone(true);n.html("&nbsp;")}else{var a=n.clone().html("&nbsp;")}a.removeAttr("colspan").removeAttr("id").insertAfter(this);if(f>1){a.attr("colspan",f)}}}if(!d){d=n}else{v+=n.html();n.remove()}}else if(r){if(t==0){p+=parseInt(n.attr("colspan")||1)}v+=n.html();n.remove()}});v+=n!=v.length?"<br />":""});d.removeAttr("colspan").removeAttr("rowspan").html(d.html()+v);if(p>1){d.attr("colspan",p)}if(o>1){d.attr("rowspan",o)}this.rte.dom.fixTable(e(t[0]).parents("table").get(0))}};this.update=function(){if(i()){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.tbcellsplit=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.command=function(){var t=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/);if(t){this.rte.history.add();var n=parseInt(this.rte.dom.attr(t,"colspan"));var r=parseInt(this.rte.dom.attr(t,"rowspan"));if(n>1||r>1){var i=n-1;var s=r-1;var o=this.rte.dom.parent(t,/^TABLE$/);var u=this.rte.dom.tableMatrix(o);if(i){for(var a=0;a<i;a++){e(this.rte.dom.create(t.nodeName)).html("&nbsp;").insertAfter(t)}}if(s){var f=this.rte.dom.indexesOfCell(t,u);var l=f[0];var c=f[1];for(var h=l+1;h<l+s+1;h++){var p;if(!u[h][c].nodeName){if(u[h][c-1].nodeName){p=u[h][c-1]}else{for(var a=c-1;a>=0;a--){if(u[h][a].nodeName){p=u[h][a];break}}}if(p){for(var a=0;a<=i;a++){e(this.rte.dom.create(p.nodeName)).html("&nbsp;").insertAfter(p)}}}}}e(t).removeAttr("colspan").removeAttr("rowspan");this.rte.dom.fixTable(o)}}this.rte.ui.update(true)};this.update=function(){var e=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/);if(e&&(parseInt(this.rte.dom.attr(e,"colspan"))>1||parseInt(this.rte.dom.attr(e,"rowspan"))>1)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.tbcolbefore=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.command=function(){var t=this;var n=this.rte.dom.tableColumn(this.rte.selection.getNode(),false,true);if(n.length){this.rte.history.add();e.each(n,function(){var n=e(this);var r=parseInt(n.attr("colspan")||1);if(r>1){n.attr("colspan",r+1)}else{var i=e(t.rte.dom.create(this.nodeName)).html("&nbsp;");if(t.name=="tbcolbefore"){i.insertBefore(this)}else{i.insertAfter(this)}}});this.rte.ui.update()}};this.update=function(){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.tbcolafter=elRTE.prototype.ui.prototype.buttons.tbcolbefore})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.tbcolrm=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.command=function(){var t=this.rte.selection.getNode();var n=this.rte.dom.selfOrParent(t,/^(TD|TH)$/);var r=e(n).prev("td,th").get(0);var i=e(n).next("td,th").get(0);var s=this.rte.dom.parent(t,/^TABLE$/);var o=this.rte.dom.tableColumn(t,false,true);if(o.length){this.rte.history.add();e.each(o,function(){var t=e(this);var n=parseInt(t.attr("colspan")||1);if(n>1){t.attr("colspan",n-1)}else{t.remove()}});this.rte.dom.fixTable(s);if(r||i){this.rte.selection.selectContents(r?r:i).collapse(true)}this.rte.ui.update(true)}};this.update=function(){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}}})(jQuery);elRTE.prototype.ui.prototype.buttons.tbrowbefore=function(e,t){this.constructor.prototype.constructor.call(this,e,t);this.command=function(){var e=this.rte.selection.getNode();var t=this.rte.dom.selfOrParent(e,/^(TD|TH)$/);var n=this.rte.dom.selfOrParent(t,/^TR$/);var r=this.rte.dom.tableMatrix(this.rte.dom.selfOrParent(t,/^TABLE$/));if(t&&n&&r){this.rte.history.add();var i=this.name=="tbrowbefore";var s=$(n).prevAll("tr").length;var o=0;var u=[];function a(e,t){while(t>0){t--;if(r[t]&&r[t][e]&&r[t][e].nodeName){return r[t][e]}}}for(var f=0;f<r[s].length;f++){if(r[s][f]&&r[s][f].nodeName){var l=$(r[s][f]);var c=parseInt(l.attr("colspan")||1);if(parseInt(l.attr("rowspan")||1)>1){if(i){o+=c}else{u.push(l)}}else{o+=c}}else if(r[s][f]=="-"){l=a(f,s);l&&u.push($(l))}}var h=$(this.rte.dom.create("tr"));for(var f=0;f<o;f++){h.append("<td>&nbsp;</td>")}if(i){h.insertBefore(n)}else{h.insertAfter(n)}$.each(u,function(){$(this).attr("rowspan",parseInt($(this).attr("rowspan")||1)+1)});this.rte.ui.update()}};this.update=function(){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TR$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}};elRTE.prototype.ui.prototype.buttons.tbrowafter=elRTE.prototype.ui.prototype.buttons.tbrowbefore;(function(e){elRTE.prototype.ui.prototype.buttons.tbrowrm=function(t,n){this.constructor.prototype.constructor.call(this,t,n);var r=this;this.command=function(){var t=this.rte.selection.getNode(),n=this.rte.dom.selfOrParent(t,/^(TD|TH)$/),r=this.rte.dom.selfOrParent(n,/^TR$/),i=this.rte.dom.selfOrParent(n,/^TABLE$/),s=this.rte.dom.tableMatrix(i);if(n&&r&&s.length){this.rte.history.add();if(s.length==1){e(i).remove();return this.rte.ui.update()}var o=[];var u=e(r).prevAll("tr").length;function a(e,t){while(t>0){t--;if(s[t]&&s[t][e]&&s[t][e].nodeName){return s[t][e]}}}function f(t,n){y=u+1;var i=null;if(s[y]){for(var o=0;o<n;o++){if(s[y][o]&&s[y][o].nodeName){i=s[y][o]}}t=t.remove();if(i){t.insertAfter(i)}else{t.prependTo(e(r).next("tr").eq(0))}}}function l(e){for(var t=0;t<e.length;t++){if(e[t]==n){return t<e.length-1?e[t+1]:e[t-1]}}}for(var c=0;c<s[u].length;c++){var h=null;var p=false;if(s[u][c]&&s[u][c].nodeName){h=s[u][c];p=true}else if(s[u][c]=="-"&&(h=a(c,u))){p=false}if(h){h=e(h);var d=parseInt(h.attr("rowspan")||1);if(d>1){h.attr("rowspan",d-1);p&&f(h,c,u)}}}var v=l(this.rte.dom.tableColumn(n));if(v){this.rte.selection.selectContents(v).collapse(true)}e(r).remove()}this.rte.ui.update()};this.update=function(){if(this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TR$/)){this.domElem.removeClass("disabled")}else{this.domElem.addClass("disabled")}}}})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.undo=function(e,t){this.constructor.prototype.constructor.call(this,e,t);this.command=function(){if(this.name=="undo"&&this.rte.history.canBack()){this.rte.history.back();this.rte.ui.update()}else if(this.name=="redo"&&this.rte.history.canFwd()){this.rte.history.fwd();this.rte.ui.update()}};this.update=function(){this.domElem.toggleClass("disabled",this.name=="undo"?!this.rte.history.canBack():!this.rte.history.canFwd())}};elRTE.prototype.ui.prototype.buttons.redo=elRTE.prototype.ui.prototype.buttons.undo})(jQuery);(function(e){elRTE.prototype.ui.prototype.buttons.unlink=function(t,n){this.constructor.prototype.constructor.call(this,t,n);this.command=function(){function r(e){return e.nodeName=="A"&&e.href}var t=this.rte.selection.getNode(),n=this.rte.dom.selfOrParentLink(t);if(!n){var i=e.browser.msie?this.rte.selection.selected():this.rte.selection.selected({wrap:false});if(i.length){for(var s=0;s<i.length;s++){if(r(i[s])){n=i[s];break}}if(!n){n=this.rte.dom.parent(i[0],r)||this.rte.dom.parent(i[i.length-1],r)}}}if(n){this.rte.history.add();this.rte.selection.select(n);this.rte.doc.execCommand("unlink",false,null);this.rte.ui.update(true)}};this.update=function(){var e=this.rte.selection.getNode();if(this.rte.dom.selfOrParentLink(e)){this.domElem.removeClass("disabled").addClass("active")}else if(this.rte.dom.selectionHas(function(e){return e.nodeName=="A"&&e.href})){this.domElem.removeClass("disabled").addClass("active")}else{this.domElem.addClass("disabled").removeClass("active")}}}})(jQuery)